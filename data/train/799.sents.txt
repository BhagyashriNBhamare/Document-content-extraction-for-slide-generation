Many paths in PlanetLab cannot be measured by Pathload.
One of the main reasons for this is timing irregularities caused by interrupt moderation of network hardware, which delays generation of interrupts for a certain period of time to reduce per-packet CPU overhead.
Motivated by this problem, we study Pathload in detail under various end-host interrupt delays and find that its trend detection mechanism becomes susceptible to non-negligible interrupt delays, making it unable to measure network paths under such conditions.
To overcome this, we propose a new method called IMR-Pathload (Interrupt Moderation Resilient Pathload), which incorporates robust trend detection algorithms based on signal de-noising techniques and reliably estimates available band-width of network paths under a wide range of interrupt delays.
Through experiments in Emulab and Internet, we find that IMR-Pathload substantially improves Pathload's measurement reliability and produces accurate bandwidth estimates under a variety of real-life conditions.
has been identified as the major problem of existing bandwidth estimation tools in practice [15].
To reduce the effect of interrupt moderation, recent tools such as Pathchirp [16] and Pathload described in [15] incorporate mechanisms that aim to "weed out" packets affected by interrupt delays.
However, Pathchirp requires manual modification to force it to send (often substantially) more probing packets to obtain an accurate estimate, prolonging measurement undesirably.
On the other hand, Pathload attempts to filter out affected packets without increasing the number of probing packets, which unfortunately has a limited effect when interrupt delays become non-trivial.
This makes Pathload's estimation much more susceptible to error, which happens fairly often in practice.
To address the above filtering problem without increasing measurement duration , we investigate Pathload's internal algorithm and find that its estimation instability with non-negligible interrupt delays stems from its delay-trend detection mechanism that is not robust under bursty packet arrival introduced by network hardware.
To overcome this, we introduce two trend-detection algorithms based on signal de-noising techniques such as wavelet decomposition and window-based averaging and call the new method IMR-Pathload (Interrupt Moderation Resilient Pathload).
Through experiments in Emulab [5] under various network settings, we find that IMR-Pathload significantly improves Pathload's performance in a wide range (0 − 500 µs) of interrupt delays δ.
Especially, under non-trivial interrupt delays (e.g., δ > 125 µs), while Pathload fails to produce estimates for any of the paths studied in this paper, IMR-Pathload measures their available bandwidth with over 88% accuracy.
Internet experiments also confirm that IMR-Pathload reliably produces bandwidth estimates even for the paths that are not measurable by Pathload.
Bandwidth of Internet paths is an important metric for applications.
Extensive research has been conducted over the years and the vast majority of work in this area focuses on end-to-end measurement.
Although several techniques [4], [13], [11], [12], [14] attempt to measure capacity of the narrow link (i.e., the slowest link in a path) or both capacity and available bandwidth of the tight link (i.e., link with the smallest available bandwidth over a path), many measurement techniques and public tools (such as [6], [9], [16]) have been developed to estimate available bandwidth of the tight link.
These methods mainly focus on fast estimation with high accuracy under a various traffic conditions.
However, since the ultimate goal of bandwidth estimators is to measure diverse Internet paths, before being a full-blown measurement tool, it is highly desirable that tools are resilient to timing irregularities caused by various OS scheduling delay jitter or hardware interrupt moderation in real networks.Note that to accurately measure bandwidth, all existing methods heavily rely on high-precision delay measurement of probe packets at end-hosts.
However, irregular timing due to interrupt moderation at network interface cards (NICs) 2 Related Work A number of techniques have been proposed to measure available bandwidth of network paths [6], [9], [16], which sends N back-to-back packets and discover a relationship between sending rates at the sender and the corresponding receiving rates at the receiver to produce bandwidth estimates of the paths.
Among them, we discuss two promising tools that use mechanisms to mitigate the effect of interrupt moderation.Pathchirp [16] uses packet-trains (called chirps) with exponentially decreasing inter-packet spacings in each chirp and infers available bandwidth using the queuing delay signature of arriving chirps.
The basic idea behind this method is that when a transmission rate r k of a packet k in a chirp reaches available bandwidth of a path under consideration, then subsequent packets j > k in the chirp will exhibit increasing queueing delay.
Hence, available bandwidth of the path is the rate r k of the packet k whose queueing delay starts increasing.
To overcome the packet-timing problem introduced by end-host interrupt moderation, Pathchirp increases the number of probing packets in each chirp by a manually selected amount and uses only those packets that (ideally) have not been affected by interrupt delays.Different from Pathchirp, Pathload [9] sends a fleet of packet-trains with a fixed rate and adjusts the sending rate for the next fleet based on delaytrend information provided by the receiver.
Pathload searches for an available bandwidth range by increasing or decreasing the sending rate of probe-trains in a binary search fashion according to trend information.
Although Pathload can reduce the effect of interrupt delays without increasing the number of packets in each probe-train, its algorithm is effective only under small interrupt delays.
As use of interrupt moderation has become a common practice in modern network settings, host machines in real networks may employ interrupt delays that vary widely in order to reduce CPU utilization and to increase network throughput.
It is reported in [7] that the range of interrupt delays recommended for Intel Gigabit NIC (GbE) is 83 − 250 µs for Microsoft Windows-based systems and 125 − 1000 µs for Linux-based systems.
Jin et al. [10] also report that a variety of systems equipped with Gigabit NICs require to delay generation of interrupts over 470 µs to achieve good throughput in receiving high-speed TCP streams and to substantially reduce CPU utilization.
The question we have now is how this wide range of interrupt delays affects Pathload's bandwidth estimation.
We discuss this issue next.
To investigate the potential impact of interrupt moderation on Pathload, we conduct experiments in Emulab [5] for different interrupt delays at the receiver 1 .
We start by describing the experimental setup.Experimental Setup For this investigation, we use a topology shown in Fig. 1, in which source PS sends probe data to the destination PR through five routers R 1 − R 5 .
Nodes S i (i = 1, 2, 3, 4) send cross-traffic packets to destination nodes D i at an average rate λ i .
The speed of all access links is 100 Mb/s (delay 10 ms) and the remaining links L i (i = 1, 2, 3, 4) between routers R i and R i+1 have capacities C i and propagation delay 40 ms.To examine Pathload's estimation reliability, we use six different network settings shown in Table 1, which lists the capacity C i and available bandwidth A i of each link L i for different experimental scenarios.
The shaded values in each row represent the tight-link capacity and available bandwidth of the path for each case.
The values in square brackets represent the capacity of the narrow link (i.e., bottleneck bandwidth) for each case.In all experiments, we use TCP cross-traffic generated by Iperf traffic generators [8] to load network paths.
For this purpose, we run 100 threads in each cross-traffic source S i to generate TCP flows that are injected into routers R 1 , Table 1.
To maintain a fixed average utilization at each link in experiments, we place an additional (auxiliary) router (not shown in the figure) between node S 1 and router R 1 , S 2 and R 1 , S 3 and R 3 , and S 4 and R 2 to limit the aggregate sending rate of the TCP flows to the capacity of the additional router.
The utilization of R i is controlled by properly setting the capacity of the auxiliary router.R 1 R 2 R 3 C1 C2 R 4 R 5 C3 C4 PR PS S2 D2 S3 D3 S4 D4 DEstimation Reliability Using the above setup, we run Pathload with 4 different values of interrupt delays δ.
To demonstrate estimation accuracy, we define the following relative error metric: e A = |A − ˜ A|/A, where A is the true available bandwidth of a path and˜Aand˜ and˜A is its estimate.
We report estimation results for each case in Table 2, which show relative estimation errors e A of available bandwidth.
As the table shows, with relatively small interrupt delays (e.g., δ ≤ 100 µs), Pathload estimates available bandwidth of the tight link with over 80% accuracy for all cases studied in this paper.
Note, however, from the table that when δ becomes larger than 125 µs, it is unable to produce estimates for any of the cases as shown in the table as empty cells, which suggests that its algorithm is susceptible to non-trivial interrupt delays.
We also conduct experiments with δ = 250 and 500 µs and confirm its inability, but omit these results for brevity.
Next, we investigate Pathload's internal algorithm in detail and identify what causes its measurement to be unstable under non-negligible values of δ.
Recall that Pathload [9] sends back-to-back packets in a train of size N = 100 with a fixed rate R and examines one-way delay 2 (OWD) of each packet in the probe-train in order to identify a trend exists in the time-series delay data.
Based on OWD delay trend, Pathload determines whether the current rate R is faster than the available bandwidth of the path under investigation.
Hence, proper detection of OWD trend in a probe-train is crucial for it to produce an accurate and reliable bandwidth estimate of the path.Note that Pathload first perform ADR (Asymptotic Dispersion Rate) probing by sending a single packet-train and checks interrupt moderation, which it detects when more than 60% of packets in a probe-train have been received back-to-back (with zero or negligible inter-packet delay).
If interrupt moderation is detected, Pathload first eliminates such coalesced packets from the received train.
Then, it directly performs PCT (Pairwise Comparison Test) and PDT (Pairwise Difference Test) on the remaining data if the number of remaining packets is no less than 5.
Recall that the PCT metric represents the fraction of consecutive OWD pairs that are increasing, while the PDT metric quantifies how strong the difference between the first and last OWDs in the data set is.
Define X j to be the one-way delay of a packet j in a set of size n. Then, the PCT and PDT metrics 3 are given by [9]:P CT = 1 n − 1 n j=2 I(X j > X j−1 ), P DT = (X n − X 1 )/ n j=2 |X j − X j−1 |, (1)where I(Y ) is one if Y holds, zero otherwise.On the other hand, when Pathload does not detect interrupt moderation from the initial check, it first eliminates back-to-back packets from the probetrain just like the previous case.
If the number of remaining packets is no smaller than 36, then Pathload selects OWDs from the remaining packets using medianbased sampling (see [9] for details) and applies the PCT and PDT tests to the sampled OWDs.To assess Pathload's trend detection mechanism, we conduct experiments for Case I with interrupt delay δ = 250 µs.
In this example, we collect one-way delay data by running Pathload with a fixed rate R = 38 Mb/s and examine how its internal algorithm specifies a delay-trend existing in OWDs.
Fig. 2(a) illustrates relative OWDs (one-way delays subtracted by their minimum value) obtained by sending packet trains at 38 Mb/s over the path in case I (available bandwidth A = 31 Mb/s).
Note in the figure that OWDs exhibit an increasing trend over all even though they decrease in a small-scale burst (successive OWDs in the same burst decrease if the latency for transferring a packet from NIC to the user space at the receiver is smaller than the inter-packet dispersions exiting NIC at the sender [15]).
Since the PCT and PDT tests cannot accurately detect a trend present in this kind of coalesced data, Pathload first removes coalesced packets before applying the PCT and PDT tests.
Fig. 2(b) shows remaining OWDs after eliminating the coalesced packets.
However, even with the data shown in Fig. 2(b), Pathload is unable to detect the increasing trend present in the data since its trend-test produces P CT = 0.5 and P DT = 0.11.
This indicates that Pathload's trend-detection mechanism is not robust under the presence of coalesced packets due to interrupt delays.Note that Pathload often discards entire packet-trains even with strong presence of a trend in the data due to its inability to detect the trend accurately.
Although more extensive evaluations are required to confirm our findings, we believe that Pathload's inaccuracy in trend detection is the major problem that makes it unlikely to be successful in real networks.
Motivated by the difficulty of characterizing delay variations in measured noisy OWD data, we study noise-filtering techniques such as wavelet-based signal processing and window-based averaging and explore their applicability in reliably identifying a trend from the data.
In what follows below, we first investigate wavelet-based signal processing techniques that are widely used in removing noise from various data sets obtained empirically [2].
To overcome the effect of interrupt delays on trend detection, we apply a simple multi-level discrete wavelet transform [1] to OWDs before performing PCT-and PDT-based trend-test.
Note that in the multi-level wavelet decomposition, each stage consists of scale and wavelet filters followed by down-sampling by a factor of 2 and separates an input signal into two sets of coefficients: scale and wavelet coefficients.
The wavelet coefficients represent a noise component in the input signal and thus are not processed further.
On the other hand, the scale coefficients are applied to the two filters in the next level as an input to further reduce noise that might still exist in the scale coefficients from the previous stage.
As a decomposition level increases, the frequency of wavelets used in filters decreases, capturing lower frequency components present in the original signal.For experiments in this section, we use the family of Daubechies wavelets [3], which are well known standard wavelets (other wavelets can be used, but performance comparison among different wavelets is beyond the scope of this paper).
Specifically, we use Daubechies' length-4 wavelets, whose scale filter coefficients are given by h 0 = 1+√ 3 4 √ 2 , h 1 = 3+ √ 3 4 √ 2 , h 2 = 3− √ 3 4 √ 2, andh 3 = 1− √ 3 4 √ 2, while its wavelet filter coefficients are g 0 = h 3 , g 1 = −h 2 , g 2 = h 1 , and g 3 = −h 0 .
Assume that a sequence s 0 , s 1 , . . . , s n−1 is an input to the j-th stage filters.
Define cA j,k and cD j,k (where k = 0, 1, . . . , n/2) to be the scale and wavelet coefficients produced at level j, respectively.
Then, cA j,k and cD j,k are given by:cA j,k = h 0 s 2k + h 1 s 2k+1 + h 2 s 2k+2 + h 3 s 2k+3 (2) cD j,k = g 0 s 2k + g 1 s 2k+1 + g 2 s 2k+2 + g 3 s 2k+3 .
(3)Note that when k ≥ n/2 − 1, there are not enough data in the input sequence to compute the coefficients using (2) and (3).
This is known as a boundary condition [17], which requires a special treatment that adds more data points to the input sequence (in this paper, we add the last value if necessary).
To demonstrate the effect of wavelet decomposition on trend detection, we decompose OWDs shown in Fig. 2(a) up to level 3 and plot in Fig. 3(a) the scale coefficients that represent the trend component of OWD data.
Applying the Interrupt Evaluation scenario method delay δ Case-I Case-II Case-III Case-IV Case-V Case-VI IMR-Pathload (wavelet) 0 µs 2.46% 1.23% 3.47% 2.69% 3.71% 6.52% 100 µs 6.47% 4.5% 3.02% 4.42% 5.98% 12.17% 125 µs 7.21% 2.64% 3.88% 1.32% 6.1% 10.77% 500 µs 5.12% 2.17% 6.78% 3.24% 7.23% 5.56% IMR-Pathload (average) 0 µs 2.07% 2.24% 2.1% 2.18% 9.67% 5.05% 100 µs 0.19% 0.71% 11.69% 1.32% 4.19% 6.82% 125 µs 1.44% 1.82% 12.58% 1.59% 2.64% 7.89% 500 µs 4.43% 4.59% 9.27% 2.55% 8.95% 6.48% same PCT and PDT tests to the scale coefficient data, we get P CT = 0.75 and P DT = 0.78, which means that OWDs exhibit an increasing trend according to the criteria used in Pathload (recall that Pathload fails to detect this increasing trend as discussed in §3.2).
Next, we explore how window-based averaging improves trend detection in noisy data.
In this approach, we take the average of OWDs in a window of size k (k-packet sliding window).
Using a smaller window makes trend-detection susceptible to a larger interrupt delay since it may not sufficiently remove noise from OWDs (we leave optimal selection of window size as future work).
For this example, we employ k = 10 and plot in Fig. 3(b) 10-packet window averages of relative OWDs shown in Fig. 2(a), which clearly shows an increasing trend.
With these averaged OWDs, we get P CT = 0.8 and P DT = 0.74, which leads us to conclude that an increasing trend exists in the measured data.We incorporate the above trend-detection mechanisms into Pathload and call it IMR-Pathload (Interrupt Moderation Resilient Pathload ).
We then evaluate it in Emulab and PlanetLab in the following section.
We investigate estimation accuracy of IMR-Pathload for different interrupt delays and report its relative estimation errors e A in Table 3.
As the table shows, IMR-Pathload produces available bandwidth estimates for all cases with 88−99% accuracy, which is significantly better than that of Pathload (see Table 2).
Notice in the table that even with a large interrupt delay δ = 500 µs, IMR-Pathload measures the paths within e A = 10% error in all studied cases (recall that Pathload can measure none of the paths if δ > 125 µs as discussed in §3.1).
In this section, we report experimental results obtained by measuring several Internet paths between Universities and a HP Lab in U.S. Measurement hosts Note that we choose these paths simply for the convenience of accessibility.
Also note that the purpose of these experiments is not to compare estimation accuracy of bandwidth estimators since we do not know exact characteristics of these paths.
Instead, we use this example to assess how reliably IMR-Pathload measures Internet paths compared to Pathload.
For this purpose, we select 5 different periods of time in a day and run IMRPathload and Pathload three times for each time period to measure a particular path.
When a tool produces bandwidth estimates reliably in all three times for each period, we report their average as its available bandwidth estimate.
If the tool cannot estimate bandwidth at least once in three trials, we consider that the tool is not able to measure that particular path reliably in that period.
For IMR-Pathload, we test both wavelet-and averaging-based algorithms, but report only wavelet-based estimates since the other produces similar results.
Table 4 shows bandwidth estimates produced by IMR-Pathload and Pathload.
As the table shows, IMR-Pathload reliably produces available bandwidth estimates for all studied paths in all measurement time periods.
Note that for a path (UMD → HP), Pathload also produces estimates that are similar to those of IMR-Pathload 4 .
However, Pathload is unable to reliably measure the other three paths (HP → Wustl, UMD → TAMU, and HP → UMD).
This paper studied Pathload under a wide range of end-host interrupt delays and identified its estimation instability under non-negligible interrupt delays.
We found that Pathload's instability stems from that its delay-trend detection mechanism is unreliable when probing packets are coalesced at the receiver.
We overcame this problem using robust trend detection algorithms (called IMR-Pathload) and showed using Emulab and Internet experiments that IMRPathload greatly improves measurement stability of Pathload under various network settings.
