Low-power Wide-Area Networks (LP-WANs) are seen as a leading candidate to network the Internet-of-Things at city-scale.
Yet, the battery life and performance of LP-WAN devices varies greatly based on their operating frequency.
In multipath-rich urban environments, received signal power varies rapidly with a low-power transmitter's frequency , impacting its transmission time, data rate and battery life.
However, the low bandwidth of LP-WANs means that there are hundreds of operating frequencies to choose from.
Among them, we show how choosing a select few of these frequencies(≤3.55%) effectively triples the battery life when compared to the rest for LP-WAN devices.
This paper presents Chime, a system enabling LP-WAN base stations to identify an optimal frequency of operation after the client sends one packet at one frequency.
Chime achieves this by analyzing the wireless channels of this packet across many base stations to disentangle multipath and ascertain an optimal frequency that maximizes client battery life and minimizes interference.
We implement Chime on a campus-scale test-bed and achieve a median gain of 3.4 dB in SINR leading to a median increase in battery life of 230% (∼1.4-5.7 years), data rate by 3.3× and reduction in interference of 2.8× over commodity LP-WANs.
Recent years have seen the emergence of Low-Power WideArea Networks (LP-WANs) as a promising technology to connect the Internet of Things.
LP-WAN technologies ( like LoRaWAN [2], SIGFOX [61], 3GPP's NB-IoT [35], LTE-M [5]) allow devices to send data at low data rate (few kbps) to base stations several miles away powered by batteries with targeted lifetimes of 5-10 years.
However, recent studies [17,19,28] show a contrasting reality in dense urban deployments where LP-WAN clients deep inside buildings experience significantly lower battery lives (∼1-2 yrs) owing to heavy signal attenuation.
They further show that over 97% of the energy consumption in an LP-WAN client can be directly attributed to its radio front-end.
While many parameters influence the battery-drain from a client's radio front-end, the main parameter that it can control is its operating frequency.
With the opening up of the TV whitespaces, narrowband LP-WAN clients have several hundreds of operating frequencies to choose from [16].
While there is rich work on spectrum sensing, particularly to avoid interference, in Wi-Fi [24] and LTE [38], LP-WANs differ in an important way: base stations span asymmetrically higher bandwidth compared to clients.
This means that base stations can directly monitor multiple frequency bands and advise clients on frequencies with minimal interference.
Yet, base stations are unaware of the precise signal power at which an LP-WAN client's signal will be received across frequencies.Our extensive experiments (Sec. 3) over a wide-area campus testbed show a promising opportunity in this respect: We show how, when set to a select few frequencies (≤ 3.55% of all available frequencies), signals from an LP-WAN client are received at much higher signal power (∼3-4 dB) at base stations.
This increases client data-rate (∼2-8 ×) and reduces their transmission time, effectively tripling their battery life 1 relative to the median frequency.
Unfortunately, finding these optimal frequencies is challenging because they correlate poorly by interpolating measurements along space, time or frequency of operation.
Further, simply sifting through even a few frequencies (e.g. as with Wi-Fi [11]) in the hope of finding the optimal ones would itself drain the battery inordinately.This paper presents Chime, a solution that explores the feasibility of offloading the LP-WAN client frequency configuration problem to the more well-equipped LP-WAN base stations.
Chime considers static clients (e.g. sensors) in urban environments whose multipath characteristics, while complex, change relatively slowly over time.
Chime uses the fact that while a single base station cannot ascertain the complex multipath, multiple spatially-distributed LP-WAN base stations can collaboratively identify an optimal operating frequency for a client based on a single association packet it transmits when it wakes up, regardless of its initial operating frequency.
Such an association packet is a standard feature of many LP-WAN protocols [51] posing minimal power overhead for the LP-WAN client.
Chime achieves this by building a novel system that uses the wireless channel-state information of this packet at one frequency received across multiple base stations to disentangle the multipath and predict the long-term battery drain for the different operating frequencies.
Further, Chime also predicts the extent of unwanted interference the client produces at base stations across different frequencies.
Thus, Chime passively infers an optimal client operating frequency, without prior calibration of the environment or known client location.Chime exploits the recent trend of massive and unplanned deployment of LP-WAN base stations [32].
For instance, LoRaWAN base stations are proposed to be deployed in Comcast MachineQ set-top boxes [32,36], meaning that many LP-WAN base stations will likely be single-antenna and often deployed indoors.
Chime proposes a novel algorithm (see Sec. 5) to synchronize these multiple single or multi-antenna LP-WAN base stations to emulate a large city-scale distributed antenna array.
In particular, Chime builds on past work in the cellular context (e.g. R2-F2 [50]) that separates signal paths using multi-antenna arrays while dealing with new challenges pertaining to distributed, irregular arrays of antennas and lowpower user devices.
Chime first models the received signals from a client across synchronized base stations to disentangle the different paths that the signals may traverse as they reflect off different objects.
These signals combine to reinforce or cancel each other leading to varying signal power across the operating frequencies of the client.
Chime then estimates how these separated signal components recombine at different client frequencies to find the one maximizing battery-life and throughput, while minimizing interference.A key challenge in estimating the multipath in urban environments is receiving time-synchronized phase measurements across multiple LP-WAN base stations to emulate a distributed MIMO array.
While recent work has successfully demonstrated distributed MIMO for WiFi [22] and cellular networks [40], LP-WAN packets last over 10× longer and therefore require much more accurate and long-lasting phase synchronization.
Further, low-power devices experience large hardware imperfections meaning that the phase of the wireless channel varies drastically even within one packet.
Hence, any phase measurements made over time across base stations would simply appear unsynchronized and random.
Chime overcomes this challenge by never measuring the phase of a low-power client in isolation, instead always measuring it relative to a high-power master base station whose signal propagation characteristics we know a priori.
We design this master base station's signal so that it can be measured at exactly the same time and frequency as the low-power client, without significantly interfering with it.
Sec. 5 describes this novel algorithm that directly compensates for phase drifts over time of the low-power client relative to a reference signal due to hardware imperfections.Next, Chime must use the synchronized phase measurements of a client's association packet to infer how the signal propagates through environment.
However, inferring all paths of the signals using measurements from a few single-antenna base stations [53] that are geographically separated is challenging.
Chime exploits the fact that though wireless signals in urban wide-area networks traverse diverse paths to base stations at different locations, they often share a very small number of common large reflectors (e.g. buildings, trees, big vehicles, etc.).
Our approach aims to discover these dominant reflectors in the environment using the small number of wireless channel measurements and model the signal propagation (Sec. 6), while accounting for variations in the size, shape and orientation of these reflectors.
Chime recombines signals in these dominant paths across frequencies to accurately predict an optimal frequency of operation for improved throughput and lower interference ( Sec. 7).
Limitations and Scope: We emphasize that Chime: (1) Considers static LP-WAN clients (e.g. sensors, metering devices); (2) Models macroscopic environmental changes but neglects fleeting reflectors (trade-offs discussed in Sec. 6.2) (3) Assumes LP-WAN clients send an association packet to base station upon waking up.
Yet, Chime remains broadly applicable to most sensor networking deployments.Evaluation and Results: We deploy Chime using LoRa as the low power technology and Semtech SX1276 chips as the client RF transceivers.
Our base-stations are USRP N210s deployed on six buildings in a 0.7 km × 0.5 km area surrounding a university campus.
Our results show that:• Chime provides a net increase in battery-life of 1.4-5.7 years (230%) achieving at an average 79% of the optimum.
• Chime can increase network throughput by 3.3× compared to commodity LoRa.
• Chime can reduce interference from LP-WAN clients at base stations by 2.1 dB, by predicting the weakest frequency.Contributions: Our specific contributions include: • A wide-area motivation study that demonstrates the inability of spectral, temporal and spatial interpolation for identifying an optimal operating frequency of an LP-WAN client.
• A novel solution for collaboratively identifying an optimal operating frequency of an LP-WAN client at the base stations using only one transmitted packet from the client.
• A system that demonstrates significant increase in battery life and throughput by identifying an optimal frequency of operation for LP-WAN radios while accounting for multipath, interference and noise.
• A wide-area deployment across a university campus showing 1.4-5.7 years of increased battery-life for LP-WAN clients.
Related work can be broadly categorized as follows:Low-Power Wide-Area Networks: Recent years have witnessed much interest in LP-WANs on both cellular (LTE-M [5] and NB-IoT [35]) and unlicensed spectrum (Semtech's LoRa [2,27,44] and SigFox [39,61]), with some proposals extending to the TV whitespaces [20].
Recent work on LP-WAN has explored interference management [19,23], developing battery-free solutions [30,45] and system deployments on the whitespaces [48] to name a few.
Chime complements this past work by considering rapid frequency configuration, a problem crucial for tackling with rapidly changing channel quality in urban spaces and improving battery-life.
Spectrum sensing: Cognitive radio and spectrum sensing solutions are primarily aimed at identifying vacant frequency bands to minimize interference with other users [56].
Many of these solutions rely on long-term statistics of channel occupancy and signal power using temporal [9,15,29,60] and spatial correlation [12,14,46,59] to make predictions.
More recent work attempts to minimize feedback by relying on sparse recovery techniques such as compressed sensing [34,43,55] or eigen-value based methods [8,57].
For LP-WANs, channel occupancy, interference and noise can be directly inferred by the base stations because they span much larger bandwidth [10] compared to clients.
Further, past work on spectrum sensing does not focus on predicting received signal power at the base station from a client across frequencies.
This is precisely Chime's goal based on measurements at one frequency from a single client radio.
Optimal radio configuration: Perhaps the solutions most closely related to this paper are systems in the Wi-Fi [41] and cellular context [50].
CSpy [41] exploits the properties of OFDM wide-band transmissions from Wi-Fi client on one Wi-Fi frequency band to accurately model wireless channels at other Wi-Fi frequency bands.
R2-F2 [50] predicts both channel magnitude and phase of LTE cellular signals based on measurements in one frequency, exploiting the properties of OFDM and large multi-antenna base stations.In contrast the LP-WAN context brings three unique challenges to the problem of finding an optimal operating frequency.
First, there are too many frequencies to choose from across whitespaces (∼800MHz of bandwidth).
For example, just running through all of them will consume about 6% of the client's battery life 2 .
Second, these radio configurations demonstrate extremely poor correlation across frequency, time and space, ruling out statistical techniques to estimate the optimal frequency of operation (see large-scale study in Sec. 3).
Finally, the vast majority of LP-WAN base stations are singleantenna [36] and often deployed indoors, ruling out past work that exploits bulky and expensive multi-antenna array infrastructure [7,50].
Indeed, while Chime builds on R2-F2 [50], To motivate the battery-saving opportunities in finding an optimal frequency configuration and the core-challenges in finding it, we present our findings from a detailed empirical study.
We focus on a simple question: "Can an optimal frequency of operation of an LP-WAN client be found by exploiting prior measurements made over time, frequency or space?"
.
We deploy 20 LoRaWAN clients at multiple locations periodically sending packets across a month iterating over 160 frequency configurations in an outdoor campus-scale testbed (see Sec. 9 for a detailed description of our testbed).
Each client was static and placed in a weather-proof case in indoor and outdoor locations with signal power measured from a single base station.
While we do not consider mobile clients, we consider varying outdoor environments over time to measure channel quality and estimated battery life for each frequency.
Estimating battery life: Prior studies have shown that the RF front-end is responsible for most of the battery consumption of a LoRaWAN device [17].
We use these prior LoRaWAN battery models [17] to estimate the energy consumed per packet at different datarates.
We then use operational characteristics for the Semtech SX1276 transceiver [4] to map the signal-to-interference plus noise ratio (SINR) to the appropriate datarates.
They show that improving signal strength from a LoRaWAN client can reduce the transmission time, thus increasing battery-life.
The reason the battery life increases so much with a few dB improvement in SINR is that, unlike WiFi, every better data rate in LP-WANs halves the packet transmission time [4].
Thus, across the SINR thresholds of these data rates, your client battery life doubles, quadruples and so on.
Our results show high variation in the RSSI of a LoRa client at base stations across time, frequency and space.
Correlation across time: Upon investigating the data across clients to the base station, we discover that most frequencies change in signal strength even across a few minutes (Fig. 2).
Our results (Fig. 3) show that using historical measurements over different time spans on a set of frequencies to predict the optimal one (via polynomial interpolation) achieves 38.27% of the optimum at best.
Our detailed study of urban multipath in Sec. 10.2 shows that this stems from gradual aggregate change in reflectors in the environment at these timescales.
Correlation across Frequency: Our results reveal that the optimal frequency-of-operation is extremely difficult to stumble upon with a random guess or even predict using a modest amount of frequency hopping.
As shown in Fig. 1, 50% of all operating frequencies provide just 27.58% of optimum battery life while 90% of them still provide only 67.09% of the optimum.
Indeed, only 1.58% of the operating frequencies are at 90% of the optimum while only 3.55% triple the median battery life.
Further, sampling several frequencies in hope of finding the top 3.55% would itself incur battery-drain, zeroing out the benefits.
We observe that even adjacent transmission frequencies perceive a difference of about 20 dB of signal strength which, in outdoor environments, is enough to make a LoRa device undetectable.
We further evaluate whether polynomial interpolation from sampling a limited number of frequencies sufficiently improves battery life and observe ( Fig. 3) that it achieves at best 70.07% of the optimum.
Correlation across Space: We evaluate whether measurements from neighboring clients can be leveraged to find an optimal frequency of operation for a client.
We consider various number of clients placed in a linear array spaced at 15 cm and predict an optimal frequency of the client in the middle via polynomial interpolation.
As shown in Fig. 3, this achieves at best 39.90% of the optimum battery life.
This section provides an overview of Chime's approach and challenges.
Chime's primary goal is to accurately measure an optimal operating frequency for an LP-WAN client by making it transmit only one packet on one frequency band.
It primarily aims to predict the received signal power of the client across all frequencies at base stations.
Since base stations span a wide bandwidth, they can readily measure channel occupancy and noise levels across frequencies, leaving received signal power from a client as the primary unknown.Chime's system architecture is designed as follows: Upon waking up and for signal association, each LP-WAN device transmits a beacon packet on its arbitrarily chosen initial frequency of operation (a standard feature of common LP-WAN protocols).
Chime then processes the received signals from this packet across the base stations at the cloud via a wired backhaul to infer an optimal frequency of operation.
Note that since the powered base stations and the cloud perform all computation, this does not impact client battery life.
The nearest base station then reports the estimated frequency to the client in its acknowledgment of the beacon.
Assumptions: While Chime does not consider mobile clients, we do consider dynamic outdoor environments.
While Chime does not model fleeting reflectors in environment, it models long-term changes in multipath as it re-analyzes the current multipath based on transmissions from the client beacon and the master base station.The rest of this paper describes three challenges in achieving the above design: (1) Synchronizing Distributed Base Stations: Chime first develops a synchronization system that allows multiple base stations to coordinate.
In doing so, it eliminates the time-varying and long-lasting phase errors due to hardware impediments, such as frequency, timing and phase offsets of low-cost and low-power wireless hardware (see Sec. 5).
(2) Disentangling Signal Paths: Next, Chime analyzes the root cause of why signal power from the client would vary across frequencies in the first place -wireless multipath.
Specifically, signals from the client traverse multiple paths as they reflect off buildings, trees and other objects before reaching the base stations.
Signals along these paths can reinforce each other or cancel each other, depending on the frequency of operation.
At the cloud, Chime combines measurements from the distributed array of base stations to decouple the different paths the signal traversed from the client, even if the geometry of these base stations is arbitrary and the environment is multipath-rich (see Sec. 6).
(3) Estimating Optimal Frequency: Chime then recombines the signal components at all possible operating frequencies to determine their expected signal power across base stations.
Chime can then use this information, along with the known interference and ambient noise at these frequencies perceived at base stations to determine the best frequency-of-operation (see Sec. 7).
In this section, we describe our approach to synchronize transmissions from the LP-WAN client between spatially distributed base stations.
Recall that Chime relies on synchronized phase measured across different base stations from a single client device to extract signal multipath.
However, these phase measurements experience time-varying errors owing to the hardware imperfections of LP-WAN radios.
Four distinct hardware impediments contribute to these phase errors: (1) Carrier Frequency offset (CFO): occurs due to subtle differences between the carrier frequency that any two radios operate on; (2) Sampling Frequency offset (SFO): occurs due to small differences between the sampling rate of the two radios; (3) Detection Delay: is produced because the packet from the client is detected with different delays across base stations; (4) Phase Lock Loop (PLL): produces an arbitrary constant phase offset at each base station's received signal, every time it tunes to a frequency.
Chime's synchronization algorithm seeks to process these wireless channels across base stations to eliminate these phase errors.Let the measured channel between the client and the base station be denoted by˜hby˜ by˜h C→B 1 whose phase is˜θis˜ is˜θ C→B 1 .
Mathematically, we can write the phase of the measured wireless channel˜θchannel˜ channel˜θ C→B 1 at time t as a function of the phase of the true channel θ C→B 1 between them, as well as various phase errors.
Let us define the following hardware impediments: (1) Carrier Frequency Offset (CFO): f C − f B 1 as the difference in carrier frequency between the client and base station.
(2) Detection Delay and Sampling Frequency Offset (SFO): t C − t B 1 denote the effective offset in time owing to detection delay at the base station and sampling frequency offset.
(3) Phase offset from the PLL: φ C − φ B 1 the phase error owing to the PLL of the client and base station locking to different values each time these radios start receiving at a center frequency.
The phase of the channel at time t is:˜ θ C→B 1 = θ C→B 1 − (2π( f C − f B 1 )t + 2π f C (t C − t B 1 ) + (φ C − φ B 1 ))(1)The rest of this section describes our approach to eliminate each of the above errors across base stations.
To eliminate phase errors in Eqn.
1, Chime leverages multiple base stations.
Specifically, we recall that a client's transmission at time t can be recorded by multiple base stations, which can measure the corresponding wireless channels.
Chime eliminates hardware impediments by exploiting the common phase shifts they induce to these channels.Mathematically, Chime estimates the wireless channel at a second base station B 2 from the same client at the same time t.
This wireless channel is written as:˜ θ C→B 2 = θ C→B 2 − (2π( f C − f B 2 )t + 2π f (t C − t B 2 ) + (φ C − φ B 2 ))(2)By subtracting Eqn.
1 and Eqn.
2 above, we get:˜ θ C→B 2 − ˜ θ C→B 1 = θ C→B 2 − θ C→B 1 +2π( f B 2 − f B 1 )t + 2π f (t B 2 − t B 1 ) + (φ B 2 − φ B 1 )(3)Note that the above difference in phases is independent of hardware impediments owing to the client, i.e. its center frequency f C , time-delay t C or initial phase φ C .
However, as it is dependent on the impediments of the two base stations, Chime still needs to estimate the phase errors due to hardware differences between pairs of spatially distributed base stations.To estimate these phase differences, Chime relies on a master base station (B M , one of the base stations) at a known location.
The master sends a signal at the same time t and frequency f C as the client (we address the challenges in achieving this without causing collisions in Sec. 5.2).
We then measure the difference in phase at the two base stations of the channel from the master base station:˜ θ B M →B 2 − ˜ θ B M →B 1 = θ B M →B 2 − θ B M →B 1 +2π( f B 2 − f B 1 )t + 2π f (t B 2 − t B 1 ) + (φ B 2 − φ B 1 )(4)Notice that Eqn.
3 and Eqn.
4 have the same effect of hardware impediments on their right-hand side.
By subtracting these two phase values, we obtain a quantity independent of hardware offsets:˜ θ C→B 2 − ˜ θ C→B 1 − ˜ θ B M →B 2 + ˜ θ B M →B 1 = θ C→B 2 − θ C→B 1 − θ B M →B 2 + θ B M →B 1 (5)The above quantity is independent of hardware offsets of the client and base stations and therefore directly captures the multiple signal paths along which the signal traverses.
Assuming the channel between master base station and other base stations can be computed (described in Sec. 5.2) at the same time and frequency as the client, the term θ B M →B 1 − θ B M →B 2 can be compensated for.
Chime therefore estimates the following product of channels h conj 12 -a complex number we call the offset-free channel whose phase value is exactly θ C→B 2 − θ C→B 1 -a function purely of the client and base stations (note: (.)
* is the complex conjugate).
h conj 12 = ˜ h C→B 2 ( ˜ h C→B 1 ) * ˜ h B M →B 1 h B M →B 2 ˜ h B M →B 2 h B M →B 1(6)Chime can then use this offset-free channel, which is free of all time-varying phase offsets, to disentangle signal paths from the client, without being impacted by hardware impediments (Sec. 6).
Note that while the phase of a single offset-free channel is ambiguous due wrapping of phase over 2π, we combine the information across multiple such channels to estimate the multipath.
This approach resembles that of many phase-based localization systems [26,49,54].
To obtain offset-free channels as in Eqn.
6 above, the base stations need to measure channels from the master base station at the same time and frequency as the client that is being tracked .
However, doing so would result in collision between the master base station packet and client packet, causing neither of their packets to be decoded.
As a result, one needs to carefully design transmissions of master base station to avoid collision with the client transmissions.
A naive approach would be to transmit the master's signal a short time interval prior to every client's transmission.
By picking an extremely short interval between the reference and client, one can neglect the additional phase drift that may accumulate.
While this approach is commonly used in distributed MIMO in Wi-Fi [33] and cellular [42], it does not apply to LP-WANs.
This is because LP-WAN packets span hundreds of milliseconds [2,13,21].
Such long packets cause phase measurements to drift significantly within a packet rendering a priori synchronization futile.
Thus, Chime needs a mechanism to estimate phase measurements at the same exact time and frequency from both reference and client by analyzing their packets transmitted concurrently.Chime circumvents this challenge by designating one of the base stations to transmit a concurrent signal on an adjacent frequency band relative to the client.
This master base station transmits its signal at the same time as the client, sending a known sequence in parallel with its transmission.
The base stations can thus estimate the wireless channels of both the master and client transmissions at the same time, albeit across adjacent frequency bands.
Chime then extrapolates the wireless channels of both the master and client to estimate its phase value at the guard band between them.
While prior works [42,58] have used beacon-based synchronization mechanisms, Chime uses piece-wise cubic spline extrapolation of both the magnitude and phase of the wireless channels across these bands for the master base station and client to estimate the magnitude and phase at the guard band in-between.
Given that these estimates occur at the same time and frequency (i.e. the guard band) across both the master and client, we can now use them in Eqn.
6 to accurately synchronize base stations and eliminate the effect of hardware imperfections.
When does the master base station transmit?
To facilitate the master base station to decode the preamble and transmit simultaneously on an adjacent channel, Chime ensures that the association packet's preamble is sufficiently long to accommodate this.
An alternative option in the cellular context (e.g. NB-IoT) is to allocate dedicated spectrum for the base station alongside the client's association packet.
Why does interpolation work?
Interpolation across frequency to estimate the channel seems to have inherent contradiction with our motivation results in Section 3.
However, it is a well known fact that outdoor channels, have a coherence bandwidth of about 250-500 KHz.
Thus, while the channel demonstrates frequency-selective fading over large bandwidths, the narrowband channel over 125 KHz is relatively flat [37].
Thus, interpolation of client and master base station channel will give a reasonable estimate of their channel at the guard band.
Note that since the base stations are high powered agents, they can indeed transmit constantly and will have significantly larger transmit power than the clients.
Thus, with a dense enough deployment of base stations (expected for LP-WANs [3,6,36]), the signal of the master base station will be received at other base stations.
Given the wireless offset-free channels of the form h conj jk from a client to a base station pair ( j, k), we next seek to separate the set of signal paths that signals traverse from the clients to the n base stations.
The key challenge in doing so is to decouple the large number of signal paths using channel measurements from a small number of base stations.
Fortunately, our results in Sec. 10 as well as extensive past literature [50] in outdoor urban wireless networks demonstrate that wireless channels tend to have small number of dominant paths.
As a result, Chime exploits this sparsity to identify the dominant signal paths using only a small number of available base stations.
While there have been solutions proposed for WiFi [41] and cellular networks [50], these techniques either model certain behavior of signals in indoor environment or require heavy infrastructure such as an array of antennas unavailable at the base station.
Furthermore, LP-WAN base stations are arranged irregularly, making it challenging to employ traditional antenna array algorithms.
Chime separates multiple signal paths by actively modeling wireless signal characteristics of a distributed array of base stations with an irregular, but known geometry.
To do so, Chime uses a maximum-likelihood [18] approach to identify the best propagation characteristics that fit the observed channels.
In particular, given that only a small number of signal Chime then uses this information to compute the optimal attenuations and phase-shifts for each signal path that fit the observed channels and the given geometry of virtual sources.
It then identifies and outputs the set of virtual sources, attenuations and phase shifts that best-fit the observed channels.
Key to Chime's algorithm is an approach that both carefully chooses the number of paths m and efficiently searches over the space of virtual source coordinates.
Problem Formulation: Mathematically, Chime's algorithm begins by iterating over a set of candidate locations for the virtual sources corresponding to a client.
For ease of exposition, we make two simplifying assumptions which we will relax later in this section: (1) Dominant reflectors are large, therefore shared by all base stations; (2) Dominant reflectors are planar and infinite.
We further only consider singlebounce reflectors and assume multi-bounce reflected paths can be broken down into equivalent single-bounce reflectors.
Let us assume for the moment that there are m such sources with known coordinates: (x p , y p , z p ) for p = 1, . . . , m.Let us denote B q to be the coordinates of the n base stations.
Consider a signal along path p traversing a distance of d p j = ||(x p , y p , z p ) − B j || to base station j from its virtual source (x p , y p , z p ).
Then the phase of the channel from this source is of the form −2π At this point, we formulate the following minimization problem that attempts to find the complex weights, α p,q , based on how well they fit the observed channels:min {α p,q } ε h conj jk 1×n 2 − [α p,q ] 1×m 2 E m 2 ×n 2 ≤ ε E m 2 ×n 2 = 1 d p j d qk e −i2π d p j −d qk λ p,q=1,...,m; j,k=1,...,nwhere i = √ −1.
Given d p j 's and d qk 's, the above optimization problem can be solved in closed-form using a leastsquares fit as (note: (.)
pinv is pseudo-inverse.)
:α est = h conj jk 1×n 2 E pinv m 2 ×n 2(7)At this point, we can estimate the goodness-of-fit of the assumed coordinates of the virtual sources corresponding to the client {(x p , y p , z p )} p=1,...m based on how well the estimated channels agree with the observed channels.
We define the goodness-of-fit of virtual source coordinates {(x p , y p , z p )} p=1,...m as:G({(x p , y p , z p )} p=1,...m ) = 1/ h conj jk − α est EThus, our problem of disentangling the multipath reduces to finding the coordinates of virtual sources in a given geograph-ical domain D, C opt = {(x opt p , y opt p , z opt p )} p=1,...,m as:C opt = arg max {(x p ,y p ,z p )} p=1,...,m ∈D} G({(x p , y p , z p )} p=1,...,m )Run-time Optimization: Running the above optimization through an exhaustive grid search is prohibitive.
Instead, Chime solves it numerically using a stochastic gradient descent algorithm [25] that begins optimization at a few of initial points (e.g. a coarse grid) in parallel.
We then perform a finer numerical gradient-based search at these points and report the coordinates for which we obtain the global maximum of goodness-of-fit.
Also, prior information about the topography of the deployment space, known reflectors, and location of the transmitter, while not necessary, can speed up the search process.
Upon optimization, Chime can fully characterize the m dominant taps by the virtual source coordinates C opt and corresponding phase shifts:α opt = h conj jk E pinv .6.
Multiple, Non-Linear and Fleeting Reflectors: Note while reflecting surfaces may be non-linear in the real world, in our model, we only consider linear reflectors.
We thus model the multiple reflections off a non-linear reflector or multiple reflectors as a composite linear reflector.
Indeed, while this assumption may sometimes lead to erroneous estimation of reflectors [52] due to increased path length, we see that by expanding the physical size of our search space for virtual sources, the error in estimating multipath is minimal.
We also ran simulation based experiments which attempt to estimate multiple reflections with a single reflector over a larger search space (due to larger path distances).
The results show that error in finding the virtual source is negligible as long as the peak is 7 dB above noise across the ISM band.
Practically, Chime only needs a source which exhibits similar distances to the base stations as the different paths to the base stations.
We also ignore fleeting and small reflectors, which occur only for one of the base stations, since they have minimal amortized effect across the received signals of the base stations.Our results in Sec.10.3 show that these assumptions work reasonably well for urban environments.Finite Reflectors: Our approach above assumes infinite planar reflectors which is not true in real world.
To encode the finiteness of the reflectors we can introduce a new parameter β p which is a boolean vector of length n to each virtual source p where β p j =1 denotes whether the signal from virtual source p reaches base station j.
This means thatE m 2 ×n 2 = β p j β qk d p j d qk e −i2π d p j −d qk λ p,q=1,...,m; j,k=1,...,nwould be sufficient to model finite reflectors.
However, simply looking for all possible β is inefficient.
Instead we add two new parameters Φ k and ψ k which represent the starting angle and spanning angle of the planar reflector.
We can reduce the possible β by imposing practical and geographical constraints.
This means we only have to optimize for 2m extra parameters instead of nm.
We can estimate the β matrix by Mobility: While our solution does not consider mobility of client, we believe even with the knowledge of location of the client device, we cannot use the reflectors computed during previous run of Chime to assist the next run.
This is because LP-WAN devices transmit very rarely (about every 15 minutes or more), which according to our observations in Sec. 3 demonstrate change in multipath of even static clients.
This will lead to a complete change in the reflectors of the client device.
Thus, under Chime's constraints, we will indeed need to recompute every reflector again.Extending to Multiple Frequencies To recover the dominant signal paths using the algorithm above, one would need to ensure that m < n, i.e. the number of dominant signal paths is sparse and well below the number of base stations in the vicinity of the LP-WAN client.
We note that not all these base stations need to be able to decode the client's transmission at the highest rate -they can simply compute wireless channels from the preamble.
However, in the instance that too few base stations are available in the vicinity of the client, Chime can improve its performance by measuring wireless channels at more frequency bands, e.g. by requesting the client to hop across a few bands.
In effect, the additional measurements across base stations makes sure our optimization in Eqn.
7 is not under-determined.
Having disentangled the multiple signal paths emerging from the client, Chime can estimate an optimal frequency of operation by recombining these signal paths across the various available transmission frequencies.
It can then identify the operating frequency by choosing the transmission frequency with the highest signal power, while also accounting for other factors such as noise and interference.Computing Signal Power The first step to selecting the best operating frequency is to determine the signal power at each frequency band.
In particular, given the offset-free channels h conj jk between a pair of base stations ( j, k) from Sec. 5 and the multipath propagation characteristics ({α p,q } and {(x p , y p , z p )}) from Sec. 6, we write the offset-free channel h conj jk,@ f at any frequency f and wavelength λ f as:h conj jk,@ f = [α p,q ] 1×m 2 E, where:E = 1 d p j d qk e −i2π d p j −d qk λ f p,q=1,...,m; j,k=1,...,nHere, d denotes the distances between virtual sources and base stations as defined in Sec. 6.
Notice that the magnitude of |h conj jk,@ f | 2 is simply the product of the signal power from the client at base station i and base station j. However, Chime needs to recover the individual power of the wireless channels at each frequency to compare them across frequencies.
Extracting these individual powers from h conj jk,@ f is challenging, because its phase was carefully constructed to remove any hardware impediments.Chime addresses this challenge by performing its algorithm in Sec. 6 on a second set of input wireless channels.
We define these wireless channels, h rat jk as:h rat jk = ˜ h C→B k (t) ˜ h B M →B j (t)h B M →B k ˜ h C→B j (t) ˜ h B M →B k (t)h B M →B jNotice that the phase of h rat jk is identical to that of h conj jk , and is therefore also free from phase errors due to hardware impediments of LP-WAN radios.
Its magnitude however is different -the ratio of the magnitude of the wireless channels to each base stations.
One can therefore apply Chime's algorithm (Sec. 6) with h rat jk instead of h conj jk as input and obtain as output the corresponding wireless channel at frequency f : h rat jk,@ f .
It is then easy to see that the power of the signal from the client to base stations j and k on frequency f is:|h C→B j ,@ f | 2 = h conj jk,@ f /h rat jk,@ f (8) |h C→B k ,@ f | 2 = (h conj jk,@ f ) * h rat jk,@ f (9)Selecting Optimal Radio Configuration Beyond signal power at the target frequency that Chime computes, data rate is also influenced by ambient noise, interference and attenuation introduced by the transmit/receive chains across frequencies.
Fortunately, LP-WAN base stations can easily measure all these quantities as they span a wide band of frequencies [31].
Chime therefore uses these measurements to compute the effective SINR of the client across frequencies to choose the one best optimizing its battery life.
While Chime is designed to compute an optimal frequency for an LP-WAN client to conserve battery-life, its approach can be used to complement related problems in LP-WAN: Coherent Combining: In addition to magnitude, recall that Chime also provides the relative phase of wireless channels between base stations.
This is useful in computing the expected wireless channels when the base stations collaborate to coherently combine the received signal across base stations in order to decode them (e.g. Charm [17] performs coherent combining in the LP-WAN context to decode weak transmissions from clients).
By knowing both the magnitude and relative phase of wireless channels at each base station across frequencies, Chime can identify the frequency-band for which the expected power of the coherently combined signal will be maximum.
Hence, Chime improves the performance of coherent combining in LP-WANs (Sec. 10.5).
Finding Nulls: Just as Chime can find the radio configuration where a client's signal power to any base station is maximum, it can also find frequency where signal power is minimum.
This is valuable in nulling interference from an unwanted client at a base station by requesting it to transmit at a frequency where interference is lower with one or more base stations.
Sec. 10.6 presents results evaluating Chime's performance in finding nulls from a client to base station.
We implement Chime on Ettus USRP N210s as base stations and reference transmitter for removing phase offsets (see Sec. 5).
These base stations measure phase based on our customized code in UHD to measure phase for Chirp Spread Spectrum modulated data at line rate.
We use Semtech SX1276 chips as LoRaWAN client transmitters.
Each picks a single frequency from the ones supported by the transmitter and transmits a small "chirp" for the base stations to hear.
The master base station (USRP N210) is designed to transmit on an adjacent band all the time for convenience of implementation(see Sec. 5.2).
We set the client spreading factor to 10 bits per symbol and the bandwidth to 125KHz (standard mode of operation).
Each base station has a reliable link to the cloud via a wired backend.
Chime's code is implemented in MAT-LAB/C++ using an in-house UHD-compatible LoRaWAN demodulator and processes the received wireless channels across base stations at the cloud.
We only consider infinite length reflectors to evaluate our system.
Note that we perform coherent combining across base stations only for Sec. 10.5 where we combine Charm with Chime.
Wide-Area Deployment: Unless specified otherwise, we evaluate Chime over four months across CMU campus and surrounding neighborhoods spanning an area of 0.5km × 0.7km in Pittsburgh leading to complex multipath scenarios as shown in Fig. 8.
Our deployment consists of 11 LP-WAN Ground Truth & Baseline: We obtain ground truth by making clients hop on all frequencies to find an optimal one.
However, only the wireless channel corresponding to a single packet on one frequency band is provided to Chime, unless stated otherwise.
We compare Chime against three baseline systems: (1) Standard LoRaWAN which chooses initial frequency arbitrarily; (2) Interpolation across frequency (as described in Sec. 3), when data across multiple frequencies is available; (3) Charm, a system that performs coherent combining across base stations [17].
Runtime: Our current implementation takes ∼ 31 sec to explore the search space of reflectors on a desktop with Core-i7 8700K and Nvidia GTX 1060 GPU with 64 GB RAM where E matrices are prefetched in memory for search space of virtual sources.
This could be significantly optimized with prior knowledge of the reflectors (topography) or parallelization on a GPU cluster -a task for future work.
Setup: An LP-WAN transmitter is moved across 25 locations in our wide-area testbed and multiple traces are collected from base stations spread across 4 months for static clients.We remove the phase offsets and plot the mean and standard deviation of the instability (standard deviation) in the phase of the offset-free channel (Sec. 5) across pairs of base stations for various SINRs.
Results: Fig. 9 shows the phase measurements of the offsetfree channel are stable across pairs of base stations with a mean standard deviation of less than 5×10 −3 even at SINRs as low as -21 dB.
This validates the stability in measurement of the phase of offset-free channels at low SINRs.
We next study the multipath in the downtown of a large city in the U.S. to validate the sparsity assumption in Sec. 6.1.
Setup: We have a base station transmit wide band chirps of 20 MHz moved over a path length of 5 km in a urban downtown environment.
Another base station is used to receive these signals.
We then collect data from over 600 different GPS-tagged locations over 0.36 km 2 .
We correlate with transmitted chirp to estimate the number of taps in the signal.
We also keep a transmitter-receiver pair 600 m away in a NLOS suburban environment to evaluate the change in sparsity of multipath and the associated channels over time.
3 Results: Fig. 10 shows that almost 77% of locations have less than 3 dominant taps in the wireless channel affecting the signal, showing the channel is predominantly sparse as we assume.
We also note that at least one of these dominant taps change over time scales of a few minutes, even for static clients.
We surmise this is due to some smaller static reflectors in the environment moving gradually over time in aggregate leading to a small number of gradually moving taps.
Fig. 11 shows how long the paths between the client and the base station typically are stable.
We define persistence of a path as the time until which atleast 80% of the energy received remains within the original path components.
We see that with 90% likelihood the sparse multipath changes within 10 mins.
If we ignore the most dominant path, we see that secondary reflectors change even faster.
We demonstrate the gains achieved by using Chime for identifying an optimal frequency of operation.Setup: We collect 20 measurements of 100 packets each, spread across 3 months from 5 locations across campus at six base stations at a given frequency f i .
Using these packets, we compute the offset-free channel for each of the base station pairs.
We then apply Chime's algorithm to compute an optimal frequency-of-operation.
We compute the gain (in dB) as the improvement of SINR at the computed operation frequency vs. the median SINR across all possible frequencies.
Finally, we measure the improvement in the battery life of LP-WAN transmitters due to lower transmission time by using Chime as the percentage of maximum battery life achievable by choosing the optimum frequency of operation.
The results are averaged over choice of initial frequency.Sparsity: As we increase the number of base stations, more and more complex multipath patterns emerge.
This is to be expected, given that more base stations are influenced by a larger number of reflectors.
This means that 2 multipath sources are not enough to correctly estimate the complex multipath patterns and hence more multipath sources are required to assess the optimum frequency of operation.
SINR Prediction: Next, we measure how accurately Chime predicts the accurate SINR of the optimal frequency of operation, across the 915 MHz ISM band.
Specifically, we compute the CDF of the difference in SINR between the predicted and actual SINR at the optimal frequency of operation.
Fig. 12 plots the results across number of base stations with only 2.7 dB of difference (median) with 6 base stations and 4 multipath(MP) sources considered.
To put this in perspective, the SINR at an arbitrary frequency would differ from the optimal by as much as 6.1 dB (median).
Our results once again validate Chime's sparsity assumptions and our modeling approach.
It shows that the gap between the association packet and transmission (∼10-15 ms) is too short for environmental dynamism to change the channels for static clients.
SINR Gain: Next we analyze the gain in SINR achieved by Chime with increasing number of base stations.
Our baseline for the gain is the median frequency-of-operation which emulates choosing an operation frequency at random.
As shown in Fig. 13, we achieve a gain of about 2.4 dB with 4 base stations which increases as we increase the number of base stations (with optimum sparsity).
With 6 base stations, we achieve a mean increase in the SINR of about 3.4 dB.Battery Life Gain: Finally, we compare the battery life 4 achieved by Chime with that of choosing frequency of operation based on temporal interpolation.
As shown in Fig. 13, we see a stark improvement of 107% in the battery life using Chime which provides a mean of 79% of the optimum over the baseline approaches.
This result shows that Chime can provide high gains for dense urban deployments.These gains in signal power allow transmitters to send at faster rates and reducing the transmission time of the LP-WAN clients.
We use methodology explained in Sec. 3 to estimate the expected battery life of the client when streaming sensed data at the optimal data rate to the base station.
As shown in Fig. 14, we see a 230% increase in the battery life of the LP-WAN transmitters over the median frequency of operation which is significant for rarely transmitting devices whose lifetime increases from 2.5 years to 8.2 years.
We study the gain in SINR and improvement in data rate that can be obtained by sampling more frequencies to further help the base stations to find an optimal frequency using Sec. 6.2.
Setup: We collect phases from 6 receiver base stations at frequencies ranging from 902-928 MHz with an interval of 500 kHz.
The frequencies chosen in each case for training are randomized to ensure correctness and the gains obtained in each case are averaged across 5 client locations across multiple weeks.
We compute the improvement in data rates achieved due to higher signal strength.
As we are sampling multiple frequencies, our baseline will be the spectral interpolation using these frequencies (as described in Sec. 3).
Results: We observe a steady increase in gain with increasing number of frequencies used for training which improves battery-life.
The improvement is significantly more than that of the baseline.
An important side-benefit of Chime is the improvement in data rate which also progressively increases.
As the SINR of the received signal improves, it enables clients to transmit at faster data rates.
While LP-WAN clients are infrequent and low-rate transmitters, this improves overall spectrum utilization in congested large-scale deployments.
In this experiment, we measure Chime's performance in improving Charm's [17] capability of coherent combining.Setup: We perform the same experiment as Sec. 10.3.
However, to compute the frequency-of-operation, we optimize for the sum of the SINR at the base stations instead of an individual base station.
Then, we coherently combine the signals at that frequency as shown in [17].
The base line is näive Charm [17] which chooses a frequency randomly.Results: Fig. 16 shows a median SINR increase of 4.5 dB with six base stations which can significantly improve the battery life of LP-WAN clients in urban environments.
As expected, the improvement is much better than that by choosing a random frequency of operation by about 2.5-3 dB.
This section predicts nulls, i.e. a bad frequency of transmission for an interfering client to a given base station to provide improvement in signal strength of legitimate client.Setup: We perform the same experiment as Sec. 10.3.
We measure the reduction in interference by using Chime to correctly estimate the frequency with the worst channel estimate.
We compute the reduction in Interference to Noise Ratio (INR) for a legitimate client in another channel.
We measure the resulting gains in data-rate for the legitimate transmitter due to reduction in interference by the interferer.Results: Fig. 17 shows that we can achieve up to 2.8× gain in the data rates of the legitimate transmitter by allocating the interferer a null frequency.
We further show that as we increase the number of base stations, the accuracy of estimating nulls increases which shows that we can get better and better gains for the legitimate transmitter.
This paper presents Chime, a system that allows an LP-WAN client to choose its optimal frequency simply by sending a single packet on one frequency band.
Chime achieves this by analyzing the paths signals traverse from the client to distributed and coordinated base stations.
Chime was evaluated in a campus-scale testbed, leading to a median battery life increase of 1.4-5.7 years over commodity LP-WANs.
While Chime's emphasis is on optimal frequency, we believe it provides the building blocks for a comprehensive interference management and distributed MIMO system built for LP-WANs.
Designing such an end-to-end system to provide enormous battery savings to low-power clients, while respecting their hardware limitations remains an important problem for future work.
This work was supported by Kavči´Kavči´c-Moura award and National Science Foundation grants 1823235, 1718435 and 1837607.
We extend warm gratitude to Prof. Srinivasa Narasimhan, Angy Malloy and Robotics Institute at CMU for allowing us to setup remote base stations for wide-scale deployment.
Finally, the authors would like to thank our shepherd Lin Zhong, anonymous NSDI reviewers, Vyas Sekar, Peter Steenkiste, Atulya, Adhishree and members of WiSe and WiTech lab for their constructive feedback and support.
