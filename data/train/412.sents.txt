Current peer-to-peer (P2P) systems often suffer from a large fraction of freeriders not contributing any resources to the network.
Various mechanisms have been designed to overcome this problem.
However, the selfish behavior of peers has aspects which go beyond resource sharing.
This paper studies the effects on the topology of a P2P network if peers selfishly select the peers to connect to.
In our model, a peer exploits locality properties in order to minimize the latency (or response times) of its lookup operations.
At the same time, the peer aims at not having to maintain links to too many other peers in the system.
We show that the resulting topologies can be much worse than if peers collaborated.
Moreover, the network may never stabilize, even in the absence of churn.
The power of peer-to-peer (P2P) computing arises from the collaboration of its numerous constituent parts, the peers.
If all the participating peers contribute some of their resources-for instance bandwidth, memory, or CPU cycles-, highly scalable decentralized systems can be built which significantly outperform existing server based solutions.
Unfortunately, in reality, many peers are selfish and strive for maximizing their own utility by benefiting from the system without contributing much themselves.
Hence the performance-and thus its success in practice!
-of a P2P system crucially depends on its capability of dealing with selfishness.
A well-known mechanism designed to cope with this freeriding problem is the tit-for-tat policy, as for instance employed by the file-distribution tool BitTorrent.However, selfish behavior in peer-to-peer networks has numerous important implications even beyond the peer's unwillingness to contribute bandwidth or memory.
For example, in unstructured P2P systems-the predominant P2P architectures in today's Internet-, a peer can select to which and to how many other peers in the network it wants to connect.
With a clever choice of neighbors, a peer can attempt to optimize its lookup performance by minimizing the latencies-or more precisely, the stretch-to the other peers in the network.
Achieving good stretches by itself is of course simple: A peer can establish links to a large number of other peers in the system.
Because the memory and maintenance overhead of such a neighbor set is large, however, egoistic peers try to exploit locality as much as possible, while avoiding to store too many neighbors.
It is this fundamental trade-off between the need to have small latencies and the desire to reduce maintenance overhead that governs the decisions of selfish peers.This paper investigates the impact of selfish neighbor selection on the quality of the resulting network topologies.
An appropriate tool to study such selfish behavior is game theory.
In particular, this paper studies the Price of Anarchy of P2P overlay creation, which is the ratio between an optimal solution obtained by perfectly collaborating participants compared to a solution generated by peers that act in an egoistic manner, optimizing their individual benefit.
The importance of studying the Price of Anarchy in peer-to-peer systems stems from the fact that it quantifies the possible degradation caused by selfishness.
Specifically, a low Price of Anarchy indicates that a system does not require an incentive-mechanism (such as tit-for-tat), because selfishness does not overly bog down the overall system performance.
If the Price of Anarchy is high, however, specific cooperation incentives (whose goal is to reduce the Price of Anarchy) need to be enforced in order to ensure that the system can perform efficiently.
In peer-to-peer systems therefore, the Price of Anarchy is a measure that helps explaining the necessity (or non-necessity) of cooperation mechanisms in various aspects of these systems.The contribution of this paper is twofold.
First, we show that the topologies of selfish, unstructured P2P systems can be much worse than in a scenario in which peers collaborate.
More precisely, we show that the Price of Anarchy is Θ(min(α, n)), where α is a parameter that captures the tradeoff between lookup performance (low stretches) and the cost of neighbor maintenance, and n is the number of peers in the system, respectively.
Thereby, the upper bound O(min(α, n)) holds for peers located in arbitrary metric spaces, including the popular growth-bounded and doubling metrics.
On the other hand, intriguingly, this bound is tight even in such a simple metric space as the 1-dimensional Euclidean space.
As a second contribution, we prove that the topology of a static peer-to-peer system consisting of selfish peers may never converge to a stable state.
That is, links may continuously change even in environments without churn (causing the network to be inherently instable).
The remainder of the paper is organized as follows.
In Section 2, we present our model and introduce the game theoretic approach.
Related work is reviewed in Section 3.
In the subsequent Section 4 we give tight bounds on the Price of Anarchy of P2P topologies.
Then, in Section 5, we show that a system consisting of selfish peers may never stabilize, even if there is no churn.
Finally, Section 6 concludes the paper.
We model the peers of a P2P network as points in a metric spaceM = (V, d), where d : V × V → [0, ∞)is the distance function which describes the underlying latencies between all pairs of peers.The effects of selfish peer behavior is studied from a gametheoretic perspective.
We consider a set of n peersV = {π 0 , π 1 , . . . , π n−1 }.
A peer can choose to which subset of other peers it wants to store pointers (IP addresses).
Formally, the strategy space of a peer πi is given by Si = 2 V \{π i } , and we will refer to the actually chosen links as πi's strategy si ∈ Si.
We say that πi maintains or establishes a link to πj if πj ∈ si.
The combination of all peers' strategies, i.e., s = (s0, ..., sn−1) ∈ S0 × · · · × Sn−1, yields a (directed) graph G[s] = (V, ∪ n−1 i=0 ({π i } × s i )), which describes the resulting P2P topology.Selfish peers exploit locality in order to maximize their lookup performance.
Concretely, a peer aims at minimizing the stretch to all other peers.
The stretch between two peers π and π is defined as the shortest distance between π and π using the links of the resulting P2P topology G divided by the direct distance, i.e., for a topologyG, stretch G (π, π ) = d G (π, π )/d(π, π ).
Clearly, it is desirable for a peer to have low stretch to other peers in order to keep its latency small.
By establishing a link to all peers in the system, a peer reaches every peer with minimal stretch 1, and the potential lookup performance is optimal.
However, storing and especially maintaining a large number of links is expensive.
1 Hence, the individual cost c i (s) incurred at a peer π is composed not only of the stretches to all other peers, but also of its degree, i.e., the number of its neighbors:ci(s) = α · |si| + i =j stretch G[s] (πi, πj).
Note that this cost function captures the classic P2P trade-off between the need to minimize latencies and the desire to store and maintain only few links, as it has been addressed by many existing systems, for example Pastry [11].
Thereby, the relative importance of degree costs versus stretch costs is expressed by the parameter α.The objective of a selfish peer is to minimize its individual cost.
In order to evaluate the topologies constructed by such selfish peersand compare them with the topologies achieved by collaborating peers-, we use the notion of a Nash equilibrium.
A P2P topology constitutes a Nash equilibrium if no peer can reduce its individual cost by changing its set of neighbors given that the connections of all other peers remain the same.
More formally, a (pure) Nash equilibrium is a combination of strategies s such that, for each peer π i , and for all alternative strategies s which differ only in the i th component (different neighbor sets for peerπ i ), c i (s) ≤ c i (s ).
This means that in a Nash equilibrium, no peer has an incentive to change its current set of neighbors, that is, Nash equilibria are stable.While peers try to minimize their individual cost, the system designer is interested in a good overall quality of the P2P network.
The social cost is the sum of all peers' individual costs, i.e.,C(G) = i c i = α|E| + i =j stretch G (π i , π j ).
The lower this social cost, the better is the system's performance.Determining the parameter α in real unstructured peer-to-peer networks is an interesting field for study.
As mentioned, α measures the relative importance of low stretches compared to the peers' degrees, and thus depends on the system or application: For example, in systems with many lookups where good response times are crucial, α is smaller than in distributed archival storage systems consisting mainly of large files.
2 In the sequel, we denote link and stretch costs byC E (G) = α|E| and C S (G) = i =j stretch G (π i , π j ), respectively.Typically, a given distribution of peers in a metric space can result in different Nash equilibria, depending on the order in which peers change their links.
To gain an understanding of the impact of selfishness on the social cost, we are particularly interested in the social cost of the worst possible Nash equilibrium.
That is, we study topologies in which no selfish peer has an incentive to change its neighbors, but in which all peers together could be much better which the latency stretch between all pairs of peers is bounded by a constant, and in which every peer has at most degree O( √ n) can be shown to be asymptotically optimal.
This trade-off has for example been achieved by the Tulip system proposed in [1].
off if they collaborated.
More precisely and using the terminology of game theory, we are interested in the Price of Anarchy, the ratio between the social cost of the worst Nash equilibrium and the social cost of the optimal topology.
The lack of cooperation in traditional P2P file-sharing systems has been well-documented over the last years [3,13], and research on the causes and possible counter-measures is very active, e.g., [5] and [9].
Most of the current literature focuses on the issue of free resource consumption, freeriding.
In contrast, the impact of other aspects of selfishness has received much less attention.
In fact, to the best of our knowledge, this is the first paper to take a step towards studying the consequences of selfish neighbor selection on the topologies of P2P networks.The first paper to study the creation of networks from a gametheoretic point of view is due to Fabrikant et al. [8].
In this paper, the authors analyze the Internet's architecture as built by economic agents, e.g., by Internet providers or autonomous systems.
Recent subsequent work on network creation in various settings includes [4,6,7].
In contrast to all these works, our model takes into account many of the intrinsic properties of P2P systems.
For instance, it captures the important locality properties of P2P systems, i.e., the desire to reduce the latencies (expressed as the stretch) experienced when performing look-up operations.
Furthermore, the fact that a peer can decide to which other peers it wishes to store pointers yields a scenario with directed links.Building structured systems that explicitly exploit locality properties has been a flourishing research area in networking and P2P computing (e.g. [1,11,12]).
In early literature on distributed hash tables (DHT), the major measure of system quality has been the number of hops required for look-up operations.
While this hopdistance is certainly of importance, it has been argued that the delay of communication (i.e., the stretch between pairs of peers) is a more relevant quality measure.
Based on results achieved in [10], systems such as [1,2,11,14] guarantee a provably bounded stretch with a limited number of links per peer.
All of these systems are structured and peers are supposed to participate in a carefully predefined topology.
Our paper complements this line of research by analyzing topologies as they are created by selfish peers, which are interested only in optimizing their individual trade-off between locality and maintenance overhead.
The Price of Anarchy is a measure to bound the degradation of a globally optimal solution caused by selfish individuals.
In this section, we show that the topologies created by selfish peers deteriorate more (compared to collaborative networks) as the cost of maintaining links becomes more important (larger α).
Concretely, in Section 4.1 we prove that for arbitrary metrics-thus, including the important and well-studied growth-bounded and doubling metrics-, the Price of Anarchy never exceeds O (min(α, n)).
We then show in Section 4.2 that this bound is tight even in the "simplest" metric space, the 1-dimensional Euclidean space.
Assume the most general setting where n peers are arbitrarily located in a given metric space M, and consider a peer π which has to find a suitable neighbor set.
Clearly, the maximal stretch from π to any other peer π in the system is at most α + 1: If stretch(π, π ) > α + 1, π could establish a direct link to π , reducing the stretch from more than α + 1 to 1, while incurring a link cost of α.
Therefore, in any Nash equilibrium, no stretch exceeds α + 1.
Because there are at most n(n − 1) directed links (from each peer to all remaining peers), the social cost of a Nash equilibrium is O(αn 2 ).
Since the optimum social costs is clearly lower bounded by Ω(αn + n 2 ), we have the following result.
THEOREM 4.1.
For any metric space M, the Price of Anarchy is O (min(α, n)).
We now show that there are P2P networks in with a Price of Anarchy of Ω(min(α, n)), which implies that the upper bound of Section 4.1 is asymptotically tight.
Intriguingly, the Price of Anarchy can deteriorate to Θ(min(α, n)) even if the underlying latency metric describes a simple 1-dimensional Euclidean space.Consider the topology G in Figure 1 in which peers are located on a 1-dimensional Euclidean line, and the distance (latency) between two consecutive peers increases exponentially towards the right.
Concretely, peer i is located at position α i−1 /2 if i is odd, and at position α i−1 if i is even.
The peers of G maintain links as follows: All peers have a link to their nearest neighbor on the left.
Odd peers additionally have a link to the second nearest peer on their right.
In the following, we prove that G constitutes a Nash equilibrium.
Afterwards, we derive the lower bound on the Price of Anarchy by computing the social cost of this topology.
PROOF.
In the following, a proof sketch is given only.
We distinguish between even and odd peers.
For both cases, we show that no peer has an incentive to deviate from its strategy.Case even peers: Every even peer i needs to link to at least one peer on its left, otherwise i cannot reach the peers j < i.
A connection to peer i − 1 is optimal, as the stretch to all peers j < i becomes 1.
Observe that every alternative link to the left would imply a larger stretch to at least one peer on the left without reducing the stretch to peers on the right.
Furthermore, i cannot reduce the distance to any-neither left nor right-peer by adding further links to the left.
Hence, it only remains to show that i cannot benefit from adding more links to the right.By adding a link to the right, peer i shortens the distance to all peers on the right.
However, the cost reduction per peer decreases as a geometric series, and any such link to the right would strictly increase i's costs.
To show this, we consider two cases in turn: i linking to an odd peer on the right, and i linking to an even peer on the right.Link to an odd peer: Consider the benefit of i adding a link to its odd neighbor i + 1.
For an odd peer j > i, we define the benefit B i,j as the stretch cost reduction caused by the addition of the link (i, i + 1).
We have, for i ≥ 2,Bi,j = stretch old (i, j) − stretchnew(i, j) = d(i, i − 1) + d(i − 1, j) d(i, j) − d(i, j) d(i, j) = 2 − 1/α 1/2α j−i − 1 .
Similarly, the savings B i,j for an even peer j > i and i ≥ 2 amount to B i,j = (2 − 1/α)/(α j−i − 1).
Hence, for all α ≥ 3.4, the total savings B i for peer i are less thanB i = odd j > i B i,j + even j > i B i,j < ∞ δ=1 2 − 1 α 1 2 α 2δ−1 − 1 + ∞ δ=1 2 − 1 α α 2δ − 1 < 4α 2 − 1 α 2 − 1 < (α≥3.4) α + 1.
Therefore, the construction of link (i, i + 1) would be of no avail (benefit smaller than cost).
Clearly, the benefit of alternative or additional links to odd neighbors on the right is even smaller.Link to an even peer: A link to an even peer j > i entails a stretch 1 to the corresponding peer instead of stretch old (i, j) = (α j − α j−1 +α i−1 −α i−2 )/(α j−1 −α i−1 ) < α+1 for α > 2.
However, the stretch from i to all other peers remains unchanged, since the path i (i − 1) (i + 1) is shorter than i (i + 2) (i + 1):α i−1 − α i−2 /2 + α i /2 − α i−2 /2 < α i+1 − α i−1 + α i+1 − α i /2for α > 1.
Therefore, an even peer i has no incentive to build links to any even peer on its right.Case odd peers: The proof that an odd peer i has no incentive to change its neighbor set is similar to the proof for even peers, and it is omitted here.Having verified that the topology of Figure 1 is a Nash equilibrium, its social cost can be computed.
Figure 1 is C(G) ∈ Θ(αn 2 ).
PROOF.
Clearly, the link costs of topology G are CE(G) ∈ Θ(αn).
But since the stretch from an odd peer i to an even peer j > i and the stretch between two even peers i and j > i are stretch(i, j) > α/2 (for α > 2), the stretch costs are CS ∈ Θ(αn 2 ).
THEOREM 4.4.
The Price of Anarchy of the peer topology G shown in Figure 1 is Θ(min(α, n)).
PROOF.
The theorem follows from Theorem 4.1 and Lemmas 4.2 and 4.3, and by the observation that the optimal social cost of a topology connecting the peers in Figure 1 is upper bounded by O(αn + n 2 ).
For the latter, assume that there are no links in Figure 1.
If every peer connects to the nearest peer on its left and to the nearest peer on its right, there are 2(n − 1) links, and all stretches are 1.
Thus, the social cost of this resulting topologyG is C( G) = α · 2(n − 1) + n(n − 1) ∈ O(αn + n 2 ).
The optimalsocial cost is at most the social cost of G.
In this section, we show that a system of selfish peers may never converge to a stable state, even in the absence of churn, mobility, or other sources of dynamism.
Interestingly, this result even holds if we assume latencies to form simple metric spaces, such as a 2-dimensional Euclidean space.THEOREM 5.1.
Regardless of the magnitude of α, there are metric spaces M, for which there exists no pure Nash equilibrium, i.e. certain P2P networks cannot converge to a stable state.
This is the case even if M is a 2-dimensional Euclidean space.Instead of presenting the formal proof, we attempt to highlight the main ideas only.
Assume that the parameter α is a multiple of 0.6, i.e., α k = 0.6k for an arbitrary integer k > 0.
Given a specific k, we show that the 2-dimensional Euclidean instance I k of Figure 2 has no pure Nash equilibrium.
Specifically, I k constitutes a situation in which there are peers π1 ∈ Π1 and π2 ∈ Π2 that continue to deviate to a better strategy ad infinitum, i.e., the system cannot converge.The n peers of instance I k are grouped into five clusters Π1, Π2, Πa, Π b , and Πc, each containing k = n/5 peers.
Within a cluster, peers are located equidistantly on a line, and each cluster's diameter is /n, where > 0 is an arbitrarily small constant.
The inter-cluster distance d(Πi, Πj) between Πi and Πj is the minimal distance between any two peers in the two clusters.
Distances not explicitly defined in Figure 2 follow implicitly from the constraints imposed by the underlying Euclidean plane.
A link from a peer πi ∈ Πi to a peer πj ∈ Πj is denoted by ij.
Clusters Πa, Π b , and Πc are called top-clusters, Π1 and Π2 are bottom-clusters, and finally, δ denotes an arbitrarily small positive number such that δ > 10.
The proof unfolds in a series of lemmas that characterize the structure of the resulting topology G[s] if the strategies s form a Nash equilibrium in I k .
First, it can be shown that in G[s], two peers in the same cluster are always connected by a path that does not leave the cluster.
In the absence of such an intra-cluster path, the shortest path between two peers in the same cluster has length at least 2 − 4δ (1−2δ is the minimal inter-cluster distance in I k ).
Hence, there is a stretch of at least 2−4δ /n between this pair of peers.
By constructing an intra-cluster link at cost α, a peer can significantly reduce these stretches, rendering such a link worthwhile.
Furthermore, it can be shown that there exists exactly one link in both directions between clusters Πa and Π b , Π b and Πc, as well as between Π1 and Π2.
In all three cases, the argument is based on the fact that without such a link, the shortest path between peers in these neighboring clusters is via a third cluster, thus significantly increasing the stretches.
Specifically, the sum of the stretches from a peer in one cluster to all peers in the neighboring cluster would exceed k(4−δ 1a ) 1+δ ab .
Because a single link to a peer in this neighboring cluster can reduce each stretch to roughly 1 + , the cost of connecting directly to a peer in the neighboring cluster is less than α + k(1 + ).
Hence, if there is no link between two neighboring clusters, a peer has an incentive to construct such a link.A third structural characteristic that can be derived for any Nash equilibrium is that for every i and j, there is at most one directed link from a cluster Π i to peers in a cluster Π j .
Since is small and all peers are linked within their clusters, peer π i ∈ Π i reduces its cost by dropping its link to cluster Π j , if another peer in Π i also has a link to a peer in Π j .
To preserve connectivity, some peers in Π 1 and Π 2 must have links to top-peers.
Based on the above observation that there is at most one link between two clusters in each direction, Lemma 5.2 1 4 5 6 a Π c Π b Π a Π c Π b Π a Π c Π b Π 1 Π 2 Π 1 Π 2 Π 1 Π 2 Π 1 Π 2 Π 1 Π 2 Π 1 Π 2 Π a Π c Π b Π a Π c Π b Π a Π c Π b Π 2 3Figure 3: Candidates for a Nash equilibrium.further narrows down the set of possible strategies for connecting peers in Π 1 and Π 2 to top-peers.
LEMMA 5.2.
In any Nash equilibrium of instance I k , it holds that i) Neither peers in Π1 nor Π2 select three links to top-peers.
ii) There exists a peer π 1 ∈ Π 1 that establishes a link to Π a .
iii) There is exactly one link from cluster Π2 to either cluster Π b or Πc, but there is no link to Πa.Correctness of all three properties is proven by verifying that there exists some node π1 ∈ Π1 or π2 ∈ Π2 that has an incentive to change its strategy in case the property is not satisfied.
If, for instance, there are two peers π 2 , π 2 ∈ Π 2 that simultaneously maintain links to Π b and Π c , (e.g. π 2 to Π b and π 2 to Π c , thus violating case iii)), π 2 can lower its costs by dropping its link to Π c .
Intuitively, this holds because the sum of the stretchesπ c ∈Π c stretch(π 2 , π c ) entailed by the indirection π 2 π 2 Π b Π c does not justify the additional cost α.It can be shown that only the six structures depicted in Figure 3 remain valid candidates for Nash topologies.
In each scenario, however, at least one peer benefits from deviating from its current strategy.Case 1: In this case, a peer π 1 ∈ Π 1 can reduce its cost by adding a link 1b to a peer in Π b .
Case 2: If the only outgoing link from Π1 to a top-cluster is to cluster Πa, the peer π2 ∈ Π2 maintaining the link to Πc can be shown to profit from switching its link from Πc to Π b .
The availability of 1b changes the optimal choice of the above mentioned peer π2 ∈ Π2.
Unlike in the previous case, π2 now prefers linking to Πc instead of Π b .
Case 4: Due to the existence of a link from a peer π 2 ∈ Π 2 to Π c , the peer π 1 ∈ Π 1 with the link to Π b has an incentive to drop this link 1b and instead use the detours via Π 2 and Π a to connect to Π c and Π b , respectively.Case 5: In this case, the peer π 1 ∈ Π 1 having the link to Π c reduces its cost by replacing this link with a link to a peer in Π b .
Case 6: Finally, this case is similar to Case 4 in the sense that π1 ∈ Π1 with the link to Π b has an incentive to remove 1c.
This proof highlights how the system is ultimately trapped in an infinite loop of strategy changes, without ever converging to a stable situation.
There is always at least one peer which can reduce its cost by changing its strategy.
For instance, the following sequence of topology changes could repeat forever (cf. Figure 3): 1 3 4 2 1 3 . . . In other words, selfish peers will not achieve a stable network topology.
In order to gain a thorough understanding of the behavior of selfish peers, aspects beyond the contribution of resources have to be taken into account.
In this paper, we have studied the impact of selfishness on the topology of a P2P network, that is, if utilitymaximizing peers select their neighbors such that both latencies and link maintenance overhead are small.
Our results show that topologies may degrade more severely when selfish peers value maintenance cost relatively higher than latency costs.
Moreover, we prove that even in the absence of mobility or churn, a P2P network consisting of selfish peers may never reach a stable state.
We consider this paper as a first step, and hope it sparks further research in this area.
It would be interesting, for instance, to incorporate aspects such as overlay routing and congestion into our model.
We are indebted to Uri Nadav for pointing us to [8].
We would also like to thank Yvonne Anne Oswald for many fruitful discussions.
