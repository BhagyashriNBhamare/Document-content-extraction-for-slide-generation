Previous analytical results on the resilience of un-structured P2P systems have not explicitly modeled heterogeneity of user churn (i.e., difference in online behavior) or the impact of in-degree on system resilience.
To overcome these limitations, we introduce a generic model of heterogeneous user churn, derive the distribution of the various metrics observed in prior experimental studies (e.g., lifetime distribution of joining users, joint distribution of session time of alive peers, and residual lifetime of a randomly selected user), derive several closed-form results on the transient behavior of in-degree, and eventually obtain the joint in/out degree isolation probability as a simple extension of the out-degree model in [13].
Peer-to-peer (P2P) networks have recently emerged as an efficient and highly resilient platform for large-scale distributed applications.
One of the fundamental problems in comprehending how these systems behave is the analysis of their properties during user churn, which is a general term describing arrival/failure of individual nodes in the system and repair algorithms applied by surviving users to counteract the effects of abrupt departures.
Unlike other distributed systems where failures may be considered rare or abnormal, most P2P networks constantly remain in the state of churn and embrace frequent failures as part of their normal operation.While many metrics of a system (e.g., search latency, path existence probability, efficiency of routing, message overhead, file popularity) affect its usefulness to the user, one commonly studied problem in the literature is the ability of P2P networks to stay connected in the face of random failures [1], [2], [6], [8], [10], [11], [12], [13], [15], [17], [21], [19], [23].
It may be argued that compromised connectivity is one of the most fundamental byproducts of churn that directly affects routing efficiency and other metrics observed by the user.
However, before resilience and performance of P2P networks can be fully understood, a good model of churn is required since even today most analytical models that consider churn [11], [13], [17], [19] do not completely capture the inherent heterogeneity of users, the impact of in-degree on the resilience of the system, or the behavior of P2P networks under non-exponential lifetimes.
We start the paper with a goal of modeling churn in P2P systems and striking a balance between model complexity and its fidelity.
Our focus for the time being lies with networks in which neighbor selection occurs only during the initial join into the system and failure of an existing neighbor.
This framework is commonly used in unstructured P2P implementations (such as the ultra-peer layer of Gnutella) where replacement takes place as a reactive response to failed keepalive messages.
Certain DHTs in which neighbor pointers do not have to change after arrival of new users (e.g., Randomized Chord [18]) fall into this category as well.
1 This type of churn was originally formalized in [13], where Leonard et al. equipped users with random lifetimes L i that determined the duration of their presence in the system and modeled neighbor replacement using random delays S i that included the timeouts to detect each failure and protocol delays to actually obtain a new neighbor.
This model, however, treated P2P users equally in their online characteristics (i.e., all user lifetimes were drawn from the same distribution) and did not consider their offline behavior as having any impact on churn.Heterogeneity of lifetimes is a fundamental property of P2P systems where some users consistently spend substantial periods of time in the system and others very little.
This observation prompts the question of whether P2P systems can indeed be modeled using a single homogeneous lifetime distribution without sacrificing model accuracy?
In addition to lifetimes, churn is characterized by the distribution of offline durations, which together with lifetimes define the availability of each user [4], [22], i.e., the average fraction of time a user is logged in.
It is therefore important to understand how offtimes contribute to the dynamics of the system and which peer characteristics affect local graph-theoretic properties (e.g., distribution of in and out-degree at each time t, probability that a given neighbor is alive, isolation probability within a lifetime) of each user.To answer these questions, we offer a generic churn model that captures the heterogeneous behavior of end-users, including their difference in online habits and diversity of offline "think time."
We view each user as an alternating renewal process that is ON when the user is logged in and OFF otherwise, where online/offline durations are drawn from (potentially different) distributions F i (x) and G i (x) unique to each user i.
This approach captures the fact that the same user in subsequent sessions is likely to exhibit characteristics resembling those of its prior sessions, while simultaneously allowing for cases where similarity between different users is arbitrarily low.Armed with this model, we obtain the distribution F (x) of lifetimes of newly arriving users, the joint lifetime distribution J(x) of the users currently in the system, and the residual lifetime distribution H(x) of a randomly selected alive user in the network.
Our results show that all three metrics are weighted functions of individual lifetime distributions F i (x), where H(x) is additionally dependent on the number of alive users currently in the graph, the probability that user i is picked by a joining peer, and the conditional residual lifetimes of the neighbors chosen by the selection method.
The model for H(x) is extremely complex and generally intractable unless neighbor selection is performed uniformly among the alive users 2 , in which case we show that H(x) can be directly obtained from F (x).
This is an important conclusion that demonstrates that instead of measuring n individual lifetime distributions, where n is the total number of users participating in the system, one can measure lifetimes of joining users to obtain F (x), which is then sufficient to entirely model the effect of churn on P2P graphs.We also revisit the observation of [24] that the users already present in Gnutella and BitTorrent networks exhibit larger average lifetimes than those joining the system.
We show that this effect is a consequence of J(x) being the spread [25] of distribution F (x), which allows us to prove that random users currently in the system have stochastically larger lifetimes than random arriving users regardless of the shape of distributions F i (x) and G i (x).
We additionally show that while F (x) may be heavy-tailed as observed in practice [5], [9], [16], it is possible that individual lifetime distributions F i (x) may all be exponential, or contain a mix of exponential and heavytailed distributions.
Occurrence of this effect depends on random availability of each user and shows that conclusions on the individual habits of peers may not be drawn from their aggregate behavior F (x).
In the second half of the paper, we tackle the issue of node resilience to isolation in the presence of churn under the assumption that neighbors provide mutual resilience benefits to each other (i.e., both outgoing and incoming edges increase resilience of peers).
Prior work [13], [14] showed that many P2P graphs stayed connected if and only if they did not develop isolated nodes during churn and derived that individual node isolation probabilities were functions ofρ = E[L i ]/E[S i ],where E[L i ] was the mean lifetime of homogeneous users and E[S i ] was the mean search (i.e., node-replacement) delay.
However, despite its importance, this approach only modeled the out-degree of each user and did not consider the increased resilience arising from additional in-degree edges arriving "in the background" to each user during its stay in the system.We overcome this shortcoming and build a complete closedform model characterizing the evolution of in-degree in unstructured systems under the assumption of uniform neighbor selection.
We first show that under certain mild assumptions the edge arrival process to each user tends to a Poisson distribution when the system size becomes sufficiently large, which is consistent with recent observation of this phenomenon in certain real networks [24].
We then derive the transient distribution of in-degree as a simple function of F (x), including cases with non-exponential peer lifetimes, and show that users who stay online longer quickly accumulate non-trivial indegree and become much more resilient to isolation over time.
This outcome was intuitively expected as it makes sense that current unstructured P2P networks have been designed such that users with more contribution to the system (i.e., longer lives) become better connected over time and provide more search capabilities to their neighbors.
In contrast, the original model of [13] showed that P2P users became progressively more susceptible to isolation as their age increased.We finish the paper by combining the in and out-degree isolation models into a single approximation that clearly shows the contribution of in-degree to the resilience of the graph.
Denoting by φ the isolation probability of a user (i.e., loss of all neighbors within its lifetime) and by φ out the same metric with only the out-degree being considered [13], we show that for exponential F (x) the following holds as search delays become asymptotically small (i.e., tend to zero):φ = 1 − e −2k 2k φ out ,(1)where k is the initial number of neighbors obtained by each arriving user.
This result illustrates that the amount of improvement from the in-degree amounts to approximately a factor of 2k reduction in the isolation probability.
Also note that for non-negligible search delays, ratio φ out /φ is larger than implied by the worst-case bound in (1), but does not admit a simple closed-form expression.
We finish the paper with examples and simulations that demonstrate this effect.
One of the first models of churn was proposed in [19], which assumed an unstructured P2P system with Poisson arrivals and departures that could be modeled as an M/M/1 queue.
Neighbor replacement in this system was in direct response to failures and was assumed to be instantaneous, where the possibilities for replacement were limited to the nodes currently alive in a certain centralized cache.
The paper showed that under user churn the graph remained connected and exhibited a logarithmic diameter, both with high probability.Later models of churn [17] and recently [11] assumed a DHT-like system in which repair algorithms were run independently of user failures and at exponentially distributed intervals (i.e., as Poisson processes).
This approach modeled the consistency check algorithm in Chord, which periodically verified the successor list and corrected invalid pointers.
While viable in general, this model required Chord to change neighbors frequently (i.e., Ω(log n) new neighbors per half-life) and stabilize at rather high rates [11] since repairs were not correlated with actual successor failures.
Additionally, these models assumed homogeneous exponential lifetimes and Poisson arrival/departure processes with no way of generalizing their results to non-exponential system dynamics.A different approach was undertaken in [13], where neighbor replacements were explicitly initiated in response to failed links.
In this setup, each joining user randomly selected k neighbors from the graph and then monitored their online presence using keep-alive messages.
3 Once the failure of an existing neighbor was detected, a uniformly random replacement was sought from among the currently alive users in the system.
Detection and replacement delays were also random, but explicitly non-zero.
Under these conditions, the paper showed that each user became isolated with probability no larger than φ out = kρ/(1 + ρ) k , where ρ was the ratio of the average lifetime to the average replacement delay, for all lifetime distributions with an exponential or heavier tail.
This result was later generalized in [14] to show that the probability of non-partitioning in many P2P networks converged as n → ∞ to that of avoiding isolation for each alive user.L i,c t R i (t) D i,c L i,c+1 To understand the dynamics of churn and performance of P2P systems, we start by creating a model of user behavior and specifying assumptions on peer arrival, departure, and selection of neighbors.
The focus of this section is to formalize recurring user participation in P2P systems in a simple model that takes into account heterogeneous browsing habits and explains the relationship between the various lifetime distributions observable in P2P networks.Due to limited space, all proofs omitted from this paper can be found in the technical report [26].
Consider a P2P system with n participating users, where each user i is either alive (i.e., present in the system) at time t or dead (i.e., logged off).
This behavior can be modeled by an alternating renewal process {Z i (t)} for each user i:Z i (t) = 1 user i is alive at time t 0 otherwise , 1 ≤ i ≤ n. (2)This framework is illustrated in Fig. 1 where variable c stands for the cycle number and durations of user i's ON (life) and OFF (death) periods are given by random variables L i,c > 0 and D i,c > 0, respectively.
The figure also shows the residual process R i (t), which is the duration of the user's remaining online presence from time t conditioned on the fact that i was alive at t.We next make several modeling assumptions about this system.
First, we suppose that users behave independently of each other and that processes {Z i (t)} and {Z j (t)} for any i = j are independent.
This means that users do not synchronize their arrival or departures and generally exhibit uncorrelated lifetime characteristics.
This assumption also implies that users simultaneously present in the system with multiple identities are not very common and have no large-scale impact on the dynamics of the network.
Second, we assume for each process {Z i (t)} that its ON durations {L i,c } ∞ c=1 have some joint distribution F i (x) and that its OFF durations {D i,c } ∞ c=1 have another joint distribution G i (x).
While this model is generic enough to allow dependency between cycle lengths, the results developed later in the paper are sensitive not to the correlational structure of processes {L i,c } ∞ c=1 and {D i,c } ∞ c=1 , but to the distribution of random variables comprising each of them.
We thus, without loss of generality, omit discussion of correlated sequences and treat all lifetime and offtime processes as i.i.d. sets of variables.
This allows us to replace{L i,c } ∞ c=1 with a random variable L i ∼ F i (x) and {D i,c } ∞ c=1 with D i ∼ G i (x).
Examples of ON/OFF distributions commonly considered in this paper are the exponential:F i (x) = 1 − e −λix (3)with mean 1/λ i and the shifted Pareto:F i (x) = 1 − (1 + x/β i ) −αi , x > 0, α i > 1(4)with mean β i /(α i −1).
For convenience of notation, define the average lifetime l i = E[L i ] and the average offline durationd i = E[D i ].
From Smith's theorem, we easily obtain that the asymptotic availability [4], [22] of each user i, i.e., the probability that it is in the system at a random instance t 0, is given by:a i = lim t→∞ P (Z i (t) = 1) = l i l i + d i .
(5)The final metric related to our churn model is the distribution of the number of users in the graph.
Denote by N (n, t) = n i=1 Z i (t) the number of users in the network at time t and notice that it is also a random process that fluctuates with time.
In cases when the size of the system is understood, we will write N (t) instead of N (n, t).
Since most P2P properties of interest require a sufficiently evolved system with t → ∞, our analysis below examines the distribution of the various metrics in the equilibrium.
Our next result shows that the limiting distribution of N (t) is Gaussian with mean and variance solely determined by the availability set {a 1 , . . . , a n }.
Lemma 1: The number of users N = lim t→∞ N (t) observed in the equilibrium tends to a Gaussian random variable with mean n i=1 a i and variancen i=1 a i (1 − a i ) as n → ∞.
Before we show simulations with our churn model, we define the rules for producing heterogeneous users and their lifetime/offtime distributions.
The only parameters that control each user's availability are l i and d i , which we draw for each user randomly from two Pareto distributions with α = 3 as described next.
For the mean ON duration, we use β = 1 and obtain E[l i ] = 1/2 hour; for the mean OFF duration, we use β = 2 and get E[d i ] = 1 hour.
Note that once pair (a) evolution(l i , d i ) is selected1.E-61.
E-51.
E-41.
E-31.
E-21.
E-1 Fig. 2.
Sample path and distribution of N (t) in system H with n = 1000 users.
The Gaussian fit is from Lemma 1.
evolution of the system.
The actual lifetimes and offtimes of each cycle are drawn from distributions F i (x) and G i (x), which are selected such that their means are equal to the corresponding l i and d i .
We study three cases throughout the paper: 1) heavy-tailed system H withF i (x) ∼ Pareto(3, 2l i ) and G i (x) ∼ Pareto(3, 2d i ); 2) very heavy-tailed system VH with F i (x) ∼ Pareto(1.5, l i /2) and G i (x) ∼ Pareto(1.5, d i /2); and 3) exponential system E with F i (x) ∼ exp(1/l i ) and G i (x) ∼ Pareto(3, 2d i ), where notation Pareto(α i , β i ) refers to (4) and exp(λ i ) to (3).
Fig. 2(a) shows one example for the evolution of system size N (t) as a function time t, which as n → ∞ tends to simple Brownian motion (also known as the limiting distribution of random walks).
Part (b) of the figure shows the PMF of N (t) at t 0 and a Gaussian fit from the previous lemma (note the log-scale of the y-axis).
Numerous additional results confirming that N (t) is a Gaussian process are omitted for brevity.
The goal of this subsection is to derive the distribution of user lifetimes when they join the system.
While each user has a different distribution of ON/OFF durations, we show below that the aggregate behavior of the system can be reduced to that of individual users in a simple closed-form expression.
Suppose that random variable L describes the lifetime of the next user that enters the system and define F (x) = P (L < x) to be its CDF.
Note that L can also be viewed as the lifetime distribution of all users who have ever visited the system.Before we proceed to the next result, let λ i be the reciprocal of the mean duration of a life-death cycle of process {Z i (t)}:λ i = 1 l i + d i ,(6)which can also be interpreted as the average arrival (or departure) rate of user i. Moreover, denote by b i the ratio of λ i to the total rate of arrival in the system:b i = λ i n j=1 λ j = n j=1 l i + d i l j + d j −1 .
(7)The next lemma shows that the lifetime distribution of all users put together is a weighted average of individual lifetime1.E-61.
E-51.
E-41.
E-31.
E-21.
E-1 1.E-51.
E-41.
E-31.
E-21.
E-11.
E+0 distributions, where the weights are biased toward those peers who frequently join and leave the system since their sessions constitute the majority of overall peer arrival into the system.Theorem 1: The distribution of lifetime of the next joining user is given by the following weighted average:F (x) = n i=1 b i F i (x),(8)whereF i (x)is the lifetime CDF of user i. Similarly, we obtain the following results.Corollary 1: Random offline duration D of the next failing user is given by G(x) = P (D < x) = n i=1 b i G i (x), where G i (x)is the offtime CDF of user i. Furthermore, the mean session time of a joining user and the mean OFF period of a failing user are respectivelyE[L] = n i=1 b i l i and E[D] = n i=1 b i d i .
We next verify (8) and discuss several implications of this result.
Two typical simulations are presented in Fig. 3 for exponential and heavy-tailed lifetimes, both of which show that the model is very consistent with simulation results.
Note that both figures are on log-log scale and plot 1 − F (x) vs. 1 + x to make the shifted Pareto distribution in (4) appear as a straight line.
Notice in Fig. 3(a) that system E produces a heavy-tailed aggregate distribution F (x) even though all individual lifetime distributions F i (x) are exponential.
This can be explained as follows.
It is well-known [3], [7] that for a hyper-exponential distribution in the form of (8) and any desired distribution W (x) with a monotonic PDF, there exists a set of weights {b 1 , . . . , b n } such that (8) converges to W (x) as n → ∞.
Given numerous possibilities for the arrivalrate set {λ 1 , . . . , λ n } in practice, it is possible that one can observe a nicely shaped Pareto, Weibull, or other distribution F (x), which is produced by a mixture of exponentials F i (x).
It may therefore be preliminary to conclude that Pareto F (x) measured experimentally [5], [22] provides any indication as to the true nature of F i (x) or individual user behavior.While our current conclusion shows that one cannot characterize the lifetimes or availability of individual peers by observing their aggregate behavior, the next question we seek to answer is whether the aggregate behavior F (x) can be used to characterize the parameters of a single user selected from the system randomly?
We focus on two such metrics below: the remaining online duration of a randomly selected user from among the peers currently alive and the joint lifetime distribution of all alive peers at sufficiently large times t. Assume that a user v selects some number of neighbors from among the existing peers in the system and does not replace them until they die.
The mechanism for initial selection and subsequent replacement may be uniformly random, based on the age of existing users, or influenced by the degree and structure of the graph (e.g., random walks).
Let R i (t) denote the length of the remaining life cycle of a given user i at time t, i.e., the remainder of the current ON cycle illustrated in Fig. 1.
Note that R i (t) is important to peer v since this metric determines how long this neighbor will be online after it is selected by v.
As shown in [13], the residual lifetime distribution solely determines the resilience of the out-degree isolation model.Define the equilibrium residual distribution of user i:H i (x) = lim t→∞ P (R i (t) < x|Z i (t) = 1)(9)and note that the offtime distribution G i (x) has no impact on H i (x) since (9) is conditioned on the fact that user i is alive at t (i.e., when a user is OFF, it is never selected by other peers for any purposes).
Then from renewal theory [20], the residual lifetime distribution of user i is:H i (x) = 1 E[L i ] x 0 (1 − F i (u))du,(10)where F i (x) is the lifetime distribution of user i as before.
Next, let R(t) be the residual lifetime of the user randomly selected by a peer v at time t, R = lim t→∞ R(t) be its equilibrium version, and H(x) = P (R < x) be its CDF.
To understand the next result, denote by:Y i (t) = 1 user i is selected at t 0 otherwise(11)the indicator process that shows whether user i is picked by v at time t and by:V i (x) = lim t→∞ P (R i (t) < x|Y i (t) = 1, Z i (t) = 1)(12)the equilibrium CDF of residual lifetimes of the users selected for replacement.
Further define:s ij = lim t→∞ P (Y i (t) = 1|Z i (t) = 1, N (t) = j)(13)to be the probability that i is selected among j existing users.
Note that our prior assumptions on the churn model dictate that V i (x) cannot depend on N (t), i.e., users do not change their lifetime behavior based on the size of the system.
We next elaborate on definitions (12)- (13).
In systems where the residual lifetime distribution of a user does not change based on whether that peer has been chosen or not, V i (x) is identical to H i (x).
This means that V i (x) = H i (x) holds only in cases when neighbor selection is independent of the lifetimes (or ages) of the selected users (e.g., this model was used in [13]).
Examples that satisfy this condition include uniform selection, selection based on content similarity or random hashing space, age-independent popularity, etc.
On the other hand, selection based on the age of potential neighbors or random walks (which depend on the in-degree of each user, which in turn depends on age) do not fall into this category.To understand s ij , we have the following examples.
For uniform selection, s ij is simply 1/j.
For stationary random walks,s ij = d i / j m=1 d m ,where d i is the stationary indegree of user i conditioned on the fact that it is alive.
For content-based selection, assume that each user shares w i files with others and that each peer is selected to be a neighbor proportionally to its "content utility" w i .
Then, s ij may be equal to w i / j m=1 w m .
As must be evident, (12)-(13) can model arbitrarily complex rules for choosing neighbors; however, tractability of the resulting distribution H(x) is questionable for all except the simplest cases.
Below, we first derive H(x) for the most generic case and show that it can be expressed as a sum of weighted individual residual distributions, where the weights are biased towards users with large availability a i and high probability s ij of being selected.
We then simplify this expression for uniform selection.Theorem 2: The residual lifetime distribution of a random neighbor in an equilibrium P2P system is given by:H(x) = n i=1 V i (x)a i n j=1 s ij P (N (n − 1) = j − 1), (14)where N (n − 1) = lim t→∞ N (n − 1, t).
The above theorem shows that H(x) depends on a number of complex factors, including the distribution of N (n − 1), CDF function V i (x), and metric s ij .
While for large n, the distribution of N (n − 1) is very close to that of N , the resulting Gaussian distribution has no suitable expressions for expanding (14) in closed-form.
Furthermore, without the knowledge of V i (x) (which depends on F i (x) as well as all other F j (x), j = i), computation of H(x) is intractable.Fortunately, for certain neighbor-selection strategies we can circumvent the difficulty of obtaining P (N (n − 1) = j − 1) in closed-form, as shown in the next lemma.Lemma 2: The residual lifetime distribution of neighbors under uniform selection is given by:H(x) = 1 n i=1 a i n i=1 a i H i (x),(15)where H i (x) is the residual CDF of user i in (10).
Next, we run simulations to confirm Lemma 2.
As shown in Fig. 4 for the exponential and Pareto cases, simulation results of H(x) match the model very well and also demonstrate that E may produce non-exponential residual lifetime distributions.
While yet again H(x) in (15) requires the knowledge of F i (x) and a i for i = 1, . . . , n, our next result shows that H(x) under uniform selection may be directly obtained from F (x).
Theorem 3: Under uniform selection, the equilibrium residual distribution H(x) of random neighbors can be reduced to the lifetime distribution of joining users:H(x) = 1 E[L] x 0 (1 − F (u)) du,(16)1.E-41.
E-31.
E-21.
E-11.
E+0 redidual lifetime+1 (hours) 1-CDF model simulations (a) system E1.E-41.
E-31.
E-21.
E-11.
E+0 where E[L] is given in Corollary 1 and F (x) is in (8).
Note that (16) is an extremely important result since it shows that in practice one only needs to measure the aggregate lifetime distribution F (x) and its mean E[L] rather than each ON distribution F i (x) and each user availability a i in order to obtain the residual lifetime distribution of a uniformly selected neighbor.
Assuming from measurement studies [5], [9], [16], that F (x) is Pareto with F (x) = 1−(1+x/β) −α , (16) reduces to:H(x) = 1 − (1 + x/β) −(α−1)(17)as also shown in [13].
Comparing (17) to F (x), we see that R is stochastically larger than user lifetimes L, i.e., P (R > x) ≥ P (L > x), which implies that a uniformly randomly selected user is more reliable than new arrivals in terms of failure.
For other neighbor selection strategies, it is important to realize that the distribution of residual lifetimes R may be completely different from (16) and should be analyzed accordingly.
Denote by J(x) the joint lifetime distribution of users currently in the system.
As observed in [24], distribution J(x) is clearly different from F (x); however, no closedform analysis has been made available to date.
The intuitional rationale behind this difference is that lifetimes of the peers observed in the system are biased towards larger values, which is commonly known as the inspection paradox [25].
In the next result, we formally derive J(x) as a function of F (x).
Theorem 4: The joint lifetime distribution J(x) of alive users in the equilibrium is:J(x) = 1 E[L] xF (x) − x 0 F (u)du ,(18)where E[L] is given in Corollary 1 and F (x) is in (8).
The accuracy of (18) was confirmed in simulations, but is omitted here for brevity.
Since spread is the convolution of two distributions H(x), it follows that exponential lifetimes F (x) imply that J(x) is the Erlang(2) distribution with mean 2E [L].
For Pareto F (x), spread J(x) is a convolution of two distributions in (17), which has no closed-form expression, but is clearly more heavy-tailed than F (x).
The next result summarizes these observations, as well as those of [24], in more formal terms.
{F i (x)} n i=1, the spread J(x) is stochastically larger than F (x) and the mean lifetime of a user currently alive in the system is double the mean residual lifetime E [R] of a uniformly selected user.In conclusion, our results demonstrate that given heterogeneous users and uniform selection of neighbors, both metrics H(x) and J(x) can be reduced to the aggregate behavior F (x) of arriving users.
The rest of the paper shows that F (x) in such systems can be additionally used to obtain the distribution of in-degree as a function of users' age and thus completely characterize local resilience of unstructured P2P networks.
Before analyzing node in-degree, we study the process of edge arrival into each user under uniform selection since this metric determines both the rate at which each user accumulates incoming neighbors and the stationary in-degree distribution.
In the following, we first examine the user arrival and failure process in a P2P system driven by our churn model, from which we obtain the behavior of edge arrival to each user.
Recall that our churn model prescribes that each arriving node find k random initial neighbors and then continuously replace them as they fail.
Let X(t) be the number of in-degree neighbors accumulated by a random user by age t, L be its random lifetime, and θ = E[X(L)] its mean number of indegree neighbors when it dies.
Under these definitions, each new arrival inserts an average of k edges and each failure brings an average of θ edges into the system.Define new edges to be those added by the arrival of new users, which occurs when a process {Z i (t)} transitions from 0 to 1, and old edges to be those added in response to the failure of existing users, which happens S time units after {Z i (t)} transitions from 1 to 0.
Since search delay S is usually negligible compared to ON/OFF cycle durations, we do not explicitly model its effect to save space.For each ON/OFF renewal process {Z i (t)} of user i, denote by T k the k-th arrival instance of user i.
Then let:M a i (t) = max{k : T k−1 ≤ t}(19)be the total number of arrivals of user i in the interval [0, t] for t > 0.
Hence, {M a i (t) : t ≥ 0} is a counting process with inter-arrival cycles given by L i + D i .
Theorem 5: Superposition arrival process: M a (t) = n i=1 M a i (t) converges as n → ∞ to a homogeneous Poisson process with rate:λ = n i=1 λ i < ∞,(20)where λ i is the reciprocal of l i + d i given by (6).
This conclusion is confirmed for the very heavy-tailed system VH (i.e., α = 1.5) in Fig. 5.
Notice in the figure that for small n, the arrival process is not Poisson; however, as n becomes sufficiently large, the inter-arrival delay1.E-81.
E-71.
E-61.
E-51.
E-41.
E-31.
E-21.
E-1 (a) VH with n = 201.E-71.
E-61.
E-51.
E-41.
E-31.
E-21.
E-11.
E+0 (20) as n becomes sufficiently large.1.E-51.
E-41.
E-31.
E-21.
E-11.
E+0 # user arrivals PMF model simulations (a) system H, ∆t = 36 sec1.E-51.
E-41.
E-31.
E-21.
E-11.
E+0 is perfectly exponential.
Furthermore, the rate of arrival λ follows (20) very well.
Next, we verify that the distribution of M a (t, t + ∆t), i.e., the number of arrivals from n sources in any fixed interval [t, t + ∆t], converges to the Poisson distribution with parameter λ as n → ∞.
We show two typical simulation results of the distribution of the number of arrivals from n = 1000 sources in the interval [t, t + ∆t] in Fig. 6.
In part (a), we have heavy-tailed system H with ∆t = 36 seconds, while in part (b) we have very heavy-tailed system VH with ∆t = 43.2 seconds.
Observe from Fig. 6 that in each case, simulation results of M a (t, t + ∆t) show a good match with a Poisson distribution with parameter λ.
For other ON/OFF distributions, simulations are also consistent with the properties of a Poisson process and are not shown here for brevity.We next follow the same steps to study the user failure (i.e., departure) process.
Denote by M d i (t) the number of departures of user i in the time interval [0, t].
Then it is clear that {M d i (t) : t ≥ 0} is a counting process with random interdeparture delays D i + L i .
Corollary 3: Superposition departure process M d (t) = n i=1 M d i (t) converges as n → ∞ to a homogeneous Poisson process with rate λ in (20).
Finally, note that the Poisson results above are not an assumption of the paper as in prior work [11], [17], [19], but rather a consequence of the churn model introduced earlier.
Armed with these observations, we next focus on the edge arrival process to each user.1.E-61.
E-51.
E-41.
E-31.
E-21.
E-11.
E+0 0 3 6 9 inter-edge-arrival time (minutes) 1-CDF model simulations (a) system H with n = 10001.E-61.
E-51.
E-41.
E-31.
E-21.
E-1 (21) for k = 10 and θ = 10.1.
E+0 0 2 4 6 8 inter-1.
E-51.
E-41.
E-31.
E-21.
E-11.
E+0 1.E-41.
E-31.
E-21.
E-11.
E+0 In this subsection, we analyze the arrival process of edges to individual users assuming uniform selection.
For other strategies for obtaining users, the analysis is significantly more complex and will be considered in future work.Theorem 6: Edge arrival into a random user under uniform selection converges as n → ∞ to the Poisson process with rate:λ v = k + θ E[L] ,(21)where k is the number of neighbors a user selects upon joining the system, θ is the mean in-degree of a user when it leaves the system, and E[L] is the mean peer lifetime.
Fig. 7 shows the distribution of edge inter-arrival delays to a single node obtained in simulations in a system with 1000 users.
Notice in its two sub-figures, the distribution of inter-arrival delay approaches exponential with rate given by (21) for both systems.
Additionally, Fig. 8 shows that the distribution of the number of edge arrivals to a node in a random interval of size ∆t approaches the Poisson distribution with the same average rate λ v in (21).
Equipped with Theorem 6, the evolution of a node's indegree becomes tractable as we show below.
As before, define X(t) to be the in-degree of a random user v at age t ≥ 0.
In this subsection, we focus on transient and stationary distributions of X(t) under uniform selection of neighbors and assuming the main churn model of the paper.Recall that the lifetime distribution of a new arrival is given by F (x) in (8).
Thus, once a new edge arrives to the current node v, it lives for a random time L whose CDF is given by F (x).
Moreover, each old edge arriving to v lives for a random duration R whose CDF is H(x) in (16).
As discussed earlier in this section, user v dies at some random time L drawn from F (x) and its average degree at that time is θ = E[X(L)].
The following theorem solves the mean in-degree E[X(t)] of a node at age t for any lifetime distribution.Theorem 7: The expected in-degree of a random node v at age t is a monotonically increasing function of age given by:E[X(t)] = t 0 k(1 − F (t − z)) + θ(1 − H(t − z)) E[L] dz, (22)where θ is derived in [26].
Although E[X(t)] in (22) appears complicated, it can be computed if the lifetime distribution F (x) and residual lifetime distribution H(x) are known.
We next carry out this task using two distributions of user lifetimes and confirm the accuracy of the model.
In the following, we use exponential and Pareto user lifetimes to compute E[X(t)] and then verify the obtained result in simulations.Theorem 8: For exponential lifetimes L ∼ exp(µ), the mean in-degree of a node at current age t isE[X(t)] = 2k(1 − e −µt )(23)and the mean in-degree at failure time is θ = k. From (23), observe that the mean in-degree of a node increases monotonically from X(0) = 0 when it arrives into the system to X(∞) = 2k when its age tends to infinity.Next, we compute θ and E[X(t)] for Pareto lifetimes.
Theorem 9: For Pareto L ∼ 1 − (1 + x/β) −α with α > 2, the mean in-degree of a node at current age t is given by:E[X(t)] = θ E[R] E[L] Q(t, α − 2) + kQ(t, α − 1),(24)whereQ(t, α) = 1 − (1 + t/β) −α , E[L] = β/(α − 1), E[R] = β/(α − 2), and the mean in-degree during failure is:θ = 2kβ 2β + E[L] .
(25)Simulation results in Fig. 9 demonstrate that the models are very accurate and indeed saturate at predicted values 2k and θE [R]/E[L] + k as age t → ∞.
It is also interesting to observe in the figure that if a node survives for more than 1 hour in the system, it develops an average of 12−15 in-degree neighbors (depending on the distribution of L) and is unlikely to be isolated from the graph from that point on.
The saturation effect illustrated in Fig. 9 suggests that P2P implementations should cap user in-degree at values no smaller than the limit of (22) for t → ∞.
The corresponding upper bound in Gnutella (i.e., 30 in-degree neighbors) satisfies this condition for the two examples shown above.
In the next section, we focus on the probability that X(t) is zero at any time t and later consider the impact of X(t) = 0 on the isolation probability.
In this subsection, we use metric P (X(t) = 0), i.e., the probability that a node's in-degree is zero at age t, to determine local in-degree resilience.
The following theorem shows that regardless of the lifetime distribution, P (X(t) = 0) is a simple function of expected in-degree E[X(t)].
Theorem 10: The probability that the in-degree of a node is zero at given age t is:P (X(t) = 0) = e −E[X(t)] ,(26)where E[X(t)] is given by (22).
Furthermore, X(t) tends to a Poisson distribution with rate E[X(t)] as n → ∞.
Notice from (26) that P (X(t) = 0) decreases in age t since E[X(t)] increases with t as shown in (22).
In other words, the longer a user stays alive in the system, the smaller the probability that it is disconnected because its in-degree is zero (of course, after E[X(t)] becomes saturated, P (X(t) = 0) stays almost constant).
Substituting (23) and (24) into (26), we verify P (X(t) = 0) for exponential and Pareto lifetimes in Table I, which demonstrates that both models of P (X(t) = 0) are very accurate.
Also observe in the table that after a user spends 2 hours in the system and with just 5 initial neighbors, its probability to have no in-degree links at time t ≥ 2 is very small (i.e., less than 5.3 × 10 −5 ).
Analytical results in the previous section show that the early stage in a node's life in the network is actually very risky from the isolation point of view as it must rely solely on its outdegree neighbors.
However, once a node survives this early stage, it increases its resilience to isolation through constantly arriving incoming edges.
In this section, we combine the indegree and out-degree models to derive the joint isolation probability of an arriving user.
As in [13], denote by W (t) the out-degree of a node v at given age t and define it to be isolated when its in-degree and out-degree are simultaneously zero.
Define time to isolation T to be the first-hitting time of both processes to state 0:T = inf{t > 0 : W (t) = X(t) = 0|W (0) = k, X(0) = 0}.
(27)Then the probability of node isolation is simply φ = P (T < L), where L is the random lifetime of node v. Note that unlike in the out-degree process, a node does not replace its incoming edges, which means that the in-degree and out-degree processes are independent of each other.In the next subsections, we derive φ for systems with exponential user lifetimes and exponential search delays using two methods.
The first approach provides an exact model using matrix algebra, while the second one shows an asymptotically accurate approximation that is available in simple closed-form.
Let pair (W (t), X(t)) be the joint process of out-degree and in-degree of a node at age t and (i, j) denote any admissible state of the joint process for 0 ≤ i ≤ k and 0 ≤ j < n. Recall from Section IV that edge arrival at any node occurs according to a Poisson process with rate (21).
Therefore, under uniform selection, new in-degree neighbors arrive to v at rate:λ v = k + θ E[L] = 2k E[L](28)since θ = k for exponential lifetimes.
Also note that the existing in-degree neighbors fail at rate µ = 1/E[L] due to the memoryless property of exponential distributions.
This leads to the following result.
Lemma 3: For exponential lifetimes L ∼ exp (µ) and exponential search times S ∼ exp(σ), the joint process {(W (t), X(t))} is a homogeneous continuous-time Markov chain with a transition rate matrix Q derived in [26].
It is convenient to treat {(W (t), X(t))} as an absorbing Markov chain in order to derive the PDF of the first-hitting time T on state (0, 0).
Assuming (0, 0) is an absorbing state, we can write Q in canonical form as:Q = 0 0 r Q 0 ,(29)where Q 0 is the rate matrix obtained by removing the rows and columns corresponding to state (0, 0) from Q and r is a column vector of transition rates into state (0, 0).
Before we proceed to the next result, define π(0) = (π (i,j) (0)) to be the initial state distribution where each cell π (i,j) (0) of the row vector π(0) is the probability that the chain starts with state (i, j) at time 0.
Since chain {(W (t), X(t)} always starts with state (k, 0), we have π (k,0) (0) = 1 and π (i,j) (0) = 0 in all other initial states.
With this result in hand, we next obtain φ.
Theorem 11: For exponential lifetimes L ∼ exp (µ) and exponential search delays S ∼ exp(σ), the probability of node isolation is given by:φ = π(0)V BV −1 r,(30)where V is a matrix of eigenvectors ofQ 0 , B = diag(b j ) is a diagonal matrix with b j = 1/(µ−ξ j ), ξ j is the j-th eigenvalue of Q 0 , and Q 0 and r are given in (29).
We verify (30) in simulations shown in Table II, which shows that our results are indeed very accurate.
While (30) provides values φ that are smaller than isolation probability φ out of the out-degree model [13] by several orders of magnitude, it is still unclear what impact in-degree has on the probability that a user gets isolated as its age increases and how large the improvement ratio φ out /φ is.
We study these issues below.
To better understand the impact of in-degree on φ, let us define the first hitting time T out on state 0 of the outdegree process {W (t)}, i.e., T out = inf{t > 0 : W (t) = 0|W (0) = k}.
Analysis in [14] shows that {W (t)} is a birthdeath Markov chain and derives its CDF function P (T out < t) in matrix form.
We use this result and the CDF of T derived in the proof of Theorem 11 to compare the distribution of isolation times in the joint in/out degree model with that studied in [14].
We plot the exact distributions of both T out and T as functions of user age in Fig. 10.
Notice in the figure that P (T out < t) increases almost linearly in time t indicating that users with large lifetimes have proportionally higher probabilities of isolation.
In contrast, the curve of P (T < t) becomes almost flat as time t increases beyond 0.5 hours showing that users with lifetimes in the range [0.
5,200] hours exhibit almost the same isolation probabilities.
In fact, once the initial 1/2-hour period is over, isolation probability is orders of magnitude smaller than in the initial phase.
As user age increases above 200 hours, the CDF of T slowly increases in time since X(t) becomes saturated and can no longer keep up with the increased possibility of isolation.
Although (30) provides exact results for φ, it relies on numerical matrix algebra.
Our next task is to combine the earlier 1.E-61.
E-51.
E-41.
E-31.
E-21.
E-1 1.
E+01.
E-1 1.
E+0 1.
E+1 1.
E+2 1.
E+3 lifetime (hours) CDF (a) T out1.E-61.
E-51.
E-41.
E-1 1.
E+0 1.
E+1 1.
E+2 1.
E+3 lifetime ( derived in-degree model (26) with the out-degree isolation result in [13] to obtain a simple closed-form solution to φ when the mean search delay E[S] → 0.
Theorem 12: For L ∼ exp(µ) and S ∼ exp(σ), isolation probability converges to the following as E[S] → 0:φ = 1 − e −2k 2k φ out ,(31)whereφ out = ρk/(1 + ρ) k and ρ = σ/µ = E[L]/E[S].
It can be seen from (31) that by considering both in-degree and out-degree, the probability of node isolation is reduced by a factor of approximately 2k for non-trivial k.
The reason for this relatively small improvement is that only a handful of users benefit from the in-degree in their isolation resilience since the majority of users depart very quickly and are unable to accumulate any in-degree neighbors.
Nevertheless, analysis of this section has important consequences as it shows that the most reliable users of the system (i.e., those with large lifetimes) extract huge benefits from the in-degree process and are thus allowed to continue providing services to others with much higher probability than possible with just the out-degree.
To complete this section, Table III shows the relative approximation error of (31) and indeed confirms its asymptotic accuracy.
Note that for large search delays, (31) provides an upper bound on the isolation probability, where the ratio φ out /φ is 3-10 times larger than the 2k suggested by (31).
For instance, for fixed E[L] = 0.5 hours and k = 6, ratio φ out /φ is 39 when E[S] = 2 minutes and 120 when E[S] = 6 minutes.
This paper introduced a simple model of churn and developed numerous closed-form results describing the behavior of users including their joint and residual lifetime distributions, evolution of system size, transient in-degree distribution, and isolation probability under the joint in/out degree model.
Future work involves modeling of non-uniform neighbor selection and churn of traditional DHTs.
