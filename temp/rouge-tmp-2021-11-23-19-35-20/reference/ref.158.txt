Remote censorship measurement tools can now detect DNS-and IP-based blocking at global scale. We close this gap by introducing Quack, a scalable, remote measurement system that can efficiently detect application-layer interference. In experiments, we test for blocking across 4458 autonomous systems, an order of magnitude larger than provided by country probes used by OONI. For individuals living under repressive or secretive government controls, cooperating with security researchers has substantial risks.An emerging body of work addresses these problems by using existing protocols and infrastructure to remotely measure network interference. When an adversary wishes to block some, but not all, of these sites, they must look into the content of requests and understand the HTTP or HTTPS headers to determine which site is being requested. This form of blocking is prevalent and effective, but it is not captured by measurements of either DNS or IP connectivity.In this paper, we introduce Quack, the first remote censorship measurement technique that efficiently detects application-layer blocking. This behavior is present in several common protocols, such as in the TLS Heartbeat Extension [42], Telnet servers supporting the "echo" option [38], FTP servers allowing anonymous read and write [43], and the Echo protocol [37]. Many studies are based on in-country vantage points such as volunteer machines or VPNs, or are one-time and country-specific measurement projects such as studies on Thailand [23], China [9], Iran [4], or Syria [7]. These direct measurements have shown how different countries use different censorship mechanisms such as the injection of fake DNS replies [3], the blocking of TCP/IP connections [46], and HTTP-level blocking [12,26]. Our measurements are also one-time; however our technique considerably reduces the cost of longitudinal measurement of censorship.Application-layer Blocking Many measurement systems measure lists of keywords to test for censorship. In the context of the web, domain names are commonly used as a proxy for services, and are typically drawn either from lists of popular global domains [2], or from curated lists of potentially sensitive domains [8]. OONI reports on DPI-based censorship in 12 countries with identified vendors, and the Tor project has faced DPI-based blocking in at least 7 countries [1]. We focus on four goals: Detection: Since the specific triggers and behavior of DPI systems are varied and opaque, Quack focuses on detecting when keywords are blocked and the what technical methods are employed. This goal is achieved by retrying upon indication of failed tests.Scalability: We aim to accurately measure the phenomenon of keyword blocking on a global scale with minimal cost. This objective is achieved by daily scans for active echo servers, which provide us with coverage of an average of 3,716 autonomous systems daily.In this section, we discuss our approach to detecting network interference, describe the specifics of the system we designed and built, define the datasets we acquired through our five experiments, and examine the ethical questions that arise in this work. GET https://google.com GET https://google.com Figure 1: Echo Protocol -The Echo Protocol, when properly performed, is a simple exchange between the client and server where the server's response is identical to the client's request. In the example above, the censoring middlebox ignores the client's inbound request, but reacts to the the echo server's response, injecting RST packets and terminating the TCP connection.We use echo servers for their defined purpose: measuring transport reliability. Figure 1 illustrates the Echo Protocol in the absence of noise.If, unlike in Figure 1, the middlebox injects a non-RST response to the echo server, we are still able to observe the interference. For example, consider example.com as a keyword wrapped within the format of an HTTP/1.1 request.During a trial, we initialize a connection to the server and send it the formatted keyword. Finally, we send a short, innocuous payload to verify that the connection remains Figure 2: Test Control Flow -A single test using an echo server is performed by following this diagram. The Echo Protocol enables trivial disambiguation between correct and incorrect responses, but distinguishing noise from network interference requires additional effort. We choose to be conservative in our designation of interference, designing our system to minimize false positives by retrying failures several times.Our implementation designates a "test" as the repeated trial of a particular server and keyword. A test proceeds in three phases, as shown in Retry Phase First, we run a trial with the keyword and retry if it fails. This is observed, for example, in China [47]. Knowing that some middleboxes perform stateful blocking, we test every server in censoring countries with an HTTP request for the most commonly censored domain in that country. The resulting distribution in Figure 3 shows 120 seconds is a sufficient delay.These steps ensure that Quack is robust and can distinguish unrelated network activity, such as sporadic packet loss and other systematic errors, from deliberate forms of network interference.Classifying Interference Although we conduct multiple trials within a test, false positive tests can still occur. This allows us to observe the phenomenon of blocking at a country level.This last layer of aggregation is formed by calculating a "blocking rate" for each keyword-country pair, equal to the number of tests classified as Blocked divided by the number classified as either Blocked or Not Blocked. In Section 6.1, we validate the countries in which we observe widespread censorship using external evidence.Due to No Result tests and echo servers churning out of our test set, the keyword blocking rates in a given country have many possible values. We do not want an n larger than the minimum number of tests per keyword, 15, because this could cause consecutive numbers of blocking results to be in the same interval, creating an artifact in the distribution. Using an ephemeral source port also allowed us to follow standard conventions and to host an abuse website on the standard HTTP port of our measurement machine. We discussed the study's design and potential risks with colleagues at our institution and externally, and we attempted to follow or exceed prevailing norms for risk reduction in censorship measurement research.Like most existing censorship measurement techniques, ours involves causing hosts within censored countries to transmit data in an attempt to trigger observable sideeffects from the censorship infrastructure. This creates a potential risk that users who control these hosts could suffer retribution from local authorities. In contrast, our measurements only involve connections between a machine we control and echo servers, so the echo servers never send or receive data from a censored destination.Still, our interactions with the echo servers are designed to trigger the censorship system, as if a request for a prohibited site had been made. We set up reverse DNS records, WHOIS records, and a web page served from port 80 on each IP address, all indicating that the hosts were part of an Internet measurement research project based at our university.Third, most echo servers look very different from enduser devices. Although we established that few echo servers are enduser devices by random sampling, in a long-term study, each server should be individually profiled, using tools such as Nmap, to exclude all those that are not clearly servers, routes, or embedded devices. Second, if we only used servers for which the operators granted consent, these operators would face a much higher risk of reprisal, since their participation would be easy to observe and would imply knowing complicity. Our ZMap scans were conducted following the ethical guidelines proposed by Durumeric et al. [15], such as respecting an IP blacklist shared with other scanning research conducted at our institution and including simple ways for packet recipients to opt out of future probes.We contrast our work with Encore [6], a censorship measurement system that has been widely criticized on ethical grounds. In our experiments, unless specified otherwise, we send the domain name in the context of a valid HTTP/1.1 GET request. We use the the global Citizen Lab Block List (CLBL) [8] from July 1, 2017 as a list of keywords to run against all echo servers. Significant difference between this test and the previous test indicates that our system is capable of detecting application-layer interference of the domains in this list. We perform the Citizen Lab experiment again, but instead of embedding the Citizen Lab domain list in valid HTTP request, we place the domain in the SNI extension of a valid TLS ClientHello message. Finally, we use our system to test the top 100,000 domains from Alexa [2] downloaded on July 12, 2017. Upon discovering hosts that respond to our SYN packets on port 7, we initiate connections to the potential echo servers. During our first trial, we find that 57, 890 servers reply with the correct string, over 3, 766 ASNs. Many of our experiments take place over the course of a day, so we measure the coverage of echo servers that reply 24 hours later. We find 92% of ASNs have an echo server that is online during this second test.In Figure 4, we show the number of servers still online after 24 hours, which is significant because our experiments run over the course of a day. To understand the composition of machines running echo servers, we randomly selected 1% of responding echo servers on July 17, 2017. This test covered 54 countries.Of the echo servers we scanned with Nmap, 251 (44.7%) had full device labels containing the words "server", "router", or "switch". OONI makes this data public with the consent of the volunteers, but probes do not have unique identifiers; therefore, we use the of number of distinct autonomous systems per country to estimate coverage.We compared the number of unique ASes observed for both tests during the week of July 8-15, 2017. First, we describe what behavior our measurements detected given a set of URLs known to be censored, in order to verify that our results correlate with previously observed phenomena. Then, we support our claim that our system works at scale, and present the results of an experiment that measured a larger corpus of domains across a greater number of countries than any previous study. We control for noise, non-protocol-compliant servers, and other anomalous behaviors by measuring echo server behavior using innocuous domains of the form testN.example.com. We observe a median domain failure rate of less than 0.01%, and a maximum failure rate across 1109 domains Figure 9: Server Reliability -For both the Control and Citizen Lab experiments, we send 1109 mock HTTP requests to all echo servers. Additionally, the domains in the upper quartile of disruption rates are evenly distributed over the class of innocuous domains, independent of the value of N. Using the technique described in Section 3.1, we classify no country as interfering with any of our control domains. This allows us to present a distribution for the null hypothesis that is independent of either variable, and therefore constant. Next we test each of the domains on the Citizen Lab global list against all echo servers by formatting them as valid HTTP GET requests. We expect to see interruption in this test because the Citizen Lab domains are known to be blocked in countries around the world. "South Korea and Jordan are those listed as Partially Free by Freedom House; however, both are indicated in ONI's most recent country profiles as performing filtering [31,32]. In the case of South Korea, blocking based on HTTP request content is specifically identified. This list has multiple other countries that are listed as "Not Free" in the Freedom of the Net report, including Belarus, Russia, Pakistan, and Vietnam.Pakistan, as an example, is identified by prior work [41] as practicing DNS poisoning. Furthermore, many nontechnical factors are included in the Freedom of the Net rating; not all "Not Free" countries block content using technical means.We have validated our classifications with anecdotal reports, but we also want to ensure there is consistency in our classification. This potentially reflects heterogeneous deployments of interference. Surprisingly, it is only blocked in five of the 13 countries where we detected censorship: China, Iran, Jordan, Turkey, and UAE. Echo servers are also often discard servers, so this requirement reduced the number of testable servers from 57,309 to 27,966. Of the 11 interfering countries, we are able to maintain enough servers to classify disruption in all but Uzbekistan.In the 10 remaining countries we observed blocking when using echo servers, we continue to observe disruption in only 4 when using the Discard Protocol: China, Egypt, Jordan, and Turkey. To demonstrate why this capability is important, as well as illuminate practices in network interference, we repeat our test of the Citizen Lab Block List, but send requests formatted as valid TLS ClientHello messages with the Server Name Indication (SNI) Extension.The Server Name Indication Extension [16] was developed to allow a TLS client to inform the server what domain it is attempting to connect to before the server must send a certificate. We continue to observe disruption in only 5 when using TLS: Egypt, Iran, Jordan, Turkey and UAE. We conclude that the blocking is being performed by the institution, and not a national policy decision to only block HTTPS.While the domains we observe interference with are similar in four of the five countries, in Iran the set of disrupted domains grows drastically when testing with TLS ClientHellos: the number of blocked domains in Iran increases from 25 to 374. The list of blocked URLs also changes composition to include significantly more domains classified by Citizen Lab as News, Human Rights, and Anonymization tools.There are several possible reasons a country would implement a policy blocking a domain through HTTPS but not HTTP. Additionally, because we only make serial requests to any particular server, we test only in countries with at least China 787 712 146 Egypt 27 20 1 Iran 1002 795 10 Saudi Arabia 3 2 1 South Korea 1572 1139 15 Thailand 38 16 0 Turkey 291 120 7 Union 3293 -180Figure 13: Interference of Alexa 100k -We test the Alexa Top 100k domains across the 40 countries with the most echo servers and observe censorship in 7. We observe that the interference in Egypt is dependent on subdomain: the root domain torproject.org is not blocked, and the subdomain www.torproject.org is blocked on one echo server in Egypt when tested only seconds apart.Another interesting blocking behavior we observe is that Iran blocks an innocuous health and lifestyle site, psiphonhealthyliving.com. This site is likely collateral damage, as Iran also blocks the domain psiphon.ca, the homepage for a censorship circumvention technology. Many categories have domains that are not blocked in multiple countries, e.g. News and Media, meaning that the particular news sites blocked by each country are not the same as in other countries that also censor News and Media sites. Countries demonstrating the tendency to block popular domains with greater frequency are China, Egypt, and Turkey, with the strongest trend being that of Turkey. This may reflect a reactive blocking strategy, in which domains are added to a blacklist when they are detected to be visited with some frequency by citizens.While the Alexa Top 100k experiment is only one snapshot of the state of application-layer censorship taking place on HTTP and HTTPS, we believe that it demonstrates the flexibility and accuracy of our tool. Finally, a censor could watch for the direction a connection and block only connections originating from inside their network. Future work can remove our final Classifying Interference step, and instead combine the raw data with that of other network disruption measurement techniques [34,35] to increase the granularity of observations.Another limitation of the measurements conducted in this study, but not to our technique in general is that we have false negatives where DPI boxes monitor only port 80 and port 443 for web traffic. This would enable longitudinal tracking of those domains, and help illuminate how and when application-layer censorship policies change.Quack also stands to provide interesting insight into censorship of other application-layer data and can be generalized to use other protocols' echo behavior. While we only focus on HTTP and HTTPS in this paper, the Echo protocol's ability to send and receive arbitrary data could be used to explore interference in other areas, such as the mobile web and app ecosystems. In this paper, we introduced Quack, a new system for remotely detecting application-layer interference at global scale, utilizing servers already deployed on the Internet, without the need to enlist volunteers to run network probes. The authors are grateful to Bill Marczak and Adam Bates for insightful discussions, and to the anonymous reviewers for their constructive feedback.